\documentclass[9pt,preprint,authoryear]{sigplanconf}

\usepackage{color}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{epsdice}
\usepackage{bbm}
\usepackage{dsfont}
\usepackage{stmaryrd}
\DeclareTextSymbol\nptextcrlambda{T3}{172}
\DeclareTextSymbolDefault\nptextcrlambda{T3}
\DeclareFontFamily{U}{npmathb}{\hyphenchar\font45}
\DeclareFontShape{U}{npmathb}{m}{n}{
      <5> <6> <7> <8> <9> <10> gen * mathb
      <10.95> mathb10 <12> <14.4> <17.28> <20.74> <24.88> mathb12
      }{}
\DeclareSymbolFont{npmathb}{U}{npmathb}{m}{n}
\DeclareFontSubstitution{U}{npmathb}{m}{n}
\DeclareMathSymbol{\npbigstar}   {2}{npmathb}{"0E} % to fool the highlighter => "
\DeclareMathSymbol{\npdotdiv}    {2}{npmathb}{"01} % to fool the highlighter => "

\DeclareFontFamily{U}{matha}{\hyphenchar\font45}
\DeclareFontShape{U}{matha}{m}{n}{
      <5> <6> <7> <8> <9> <10> gen * matha
      <10.95> matha10 <12> <14.4> <17.28> <20.74> <24.88> matha12
      }{}
\DeclareSymbolFont{matha}{U}{matha}{m}{n}
\DeclareFontSubstitution{U}{matha}{m}{n}
\DeclareMathSymbol{\npoasterisk} {2}{matha}{"66} % to fool the highlighter => "
\DeclareMathSymbol{\npnotequiv}  {3}{matha}{"19} % to fool the highlighter => "
\title{Names For Free --- Polymorphic Views of Names and Binders}
\hyphenation{crypto--graphic}
\authorinfo{Jean-Philippe Bernardy}{Chalmers University of Technology and University of Gothenburg}{bernardy@chalmers.se}
\authorinfo{Nicolas Pouillard}{IT University Copenhagen}{npou@itu.dk}

\begin{document}

\maketitle

\begin{abstract}
We propose a novel technique to represent names and binders in
Haskell. The dynamic (run-time) representation is based on de Bruijn
indices, but it features an interface to write and manipulate
variables conviently, using Haskell-level lambdas and variables. The
key idea is to use rich types: a subterm with an additional free variable
is viewed either as $\forall v. v \rightarrow \mathsf{Term} (a + v)$
or $\exists v. v \times \mathsf{Term} (a + v)$ depending on weather it
is constructed or analysed.  We demonstrate on a number of examples
how this approach approach permits to express terms construction and 
manipulation in a natural way, while retaining the good properties of
representations based on de Bruijn indices.

\end{abstract}

\category{D.3.3}{Language Constructs and Features}{}

\begin{keywords}name binding,
polymorphism,
parametricity,
type-classes,
nested types\end{keywords}

\section{Introduction\label{intro}}

%
%paragraphName: the line of work where we belong
One of the main application areas of functional programming
    languages such as \textsc{Haskell} is programming language technology. In
    particular, \textsc{Haskell} programmers often find themselves manipulating
    data structures representing some higher-order object languages,
    featuring binders and names.%


%
%paragraphName: identifying the gap
Yet, the most commonly used representations for names and binders
    yield code which is difficult to read, or error-prone to write
    and maintain. The techniques in question are often referred as
    {``}nominal{''}, {``}de{~}Bruijn indices{''} and {``}Higher-Order Abstract
    Syntax (HOAS){''}.%


%
%paragraphName: Nominal pros&cons
In the nominal approach, one typically uses some atomic type to
    represent names. Because a name is simply referred to
    the atom representing it, the nominal style is
    natural. The main issues with this technique are that variables
    must sometimes be renamed in order to avoid name capture (that is,
    if a binder refers to an already used name, variables might end up
    referring to the wrong binder). The need for renaming demands a way
    to generate fresh atoms. This side effect can be resolved with a
    supply for unique atoms or using an abstraction such as a monad
    but is disturbing if one wishes to write functional code.
    Additionally, nominal representations are not canonical. (For instance, two $ \alpha $-equivalent 
    representations of the same term such as \textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{x}} and \textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{y}} may 
    be different). Hence special care has to be taken to prevent user code
    to violate the abstraction barrier. Furthermore fresh name
    generation is an observable effect breaking referential transparency
    (\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{fresh}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{in}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\ensuremath{\npnotequiv}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{fresh}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{in}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}). For instance a function
    generating fresh names and not properly using them to close
    abstractions becomes impure.%


%
%paragraphName: de Bruijn pros&cons
To avoid the problem of name capture, one can represent names
    canonically, for example by the number of binders, typically $ \lambda $,
    to cross between an occurrence and its binding site (a de{~}Bruijn index). 
    This has the added benefit of making $ \alpha $-equivalent terms syntactically equal.
    In practice
    however, this representation makes it hard to manipulate terms{:}
    instead of calling things by name, programmers have to rely on their
    arithmetic abilities, which turns out to be error-prone. As soon as
    one has to deal with more than just a couple open bindings, it becomes
    easy to make mistakes.%


%
%paragraphName: HOAS
Finally, one can use the binders of the host language (in our case \textsc{Haskell})
    to represent binders of the object language. This technique (called HOAS)
    does not suffer
    from name-capture problems nor does it involve arithmetic. However the 
    presence of functions in the term representation mean that it is difficult 
    to manipulate, and it may contain values which do not represent any term.%


%
%paragraphName: contribution
The contribution of this paper is a new programming interface for binders, which
    provides the ability to write terms in a natural style close to
    concrete syntax. We can for example build the application function
    of the untyped $ \lambda $-calculus as follows{:}%


%
%comment: {- --
%


{\nopagebreak }

%
%code:
%
%comment: -- Building the following term: \ f x → f x
%apTm = lam $ \ f → lam $ \ x → var f `App` var x
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0.63,0.13,0.94}{\texttt{\makebox[1.22ex][c]{-}\makebox[1.22ex][c]{-}\mbox{\hspace{0.50em}}Building\mbox{\hspace{0.50em}}the\mbox{\hspace{0.50em}}following\mbox{\hspace{0.50em}}term{:}\mbox{\hspace{0.50em}}$ \lambda $\mbox{\hspace{0.50em}}f\mbox{\hspace{0.50em}}x\mbox{\hspace{0.50em}}$ \rightarrow $\mbox{\hspace{0.50em}}f\mbox{\hspace{0.50em}}x}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{apTm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{{`}App{`}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%comment: -- -}
%


%
%paragraphName:
and we are able to test if a term is eta-contractible using the
    following function{:}%


%
%comment: {- --
%


{\nopagebreak }

%
%code:
%
%comment: canEta (Lam e) = unpack e $ \ x t → case t of
%  App e1 (Var y) → y `isOccurrenceOf` x &&
%                    x `freshFor` e1
%  _ → False
%canEta _ = False
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{canEta}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{e}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{unpack}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{e}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{case}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{of}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{App}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{e1}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{`}isOccurrenceOf{`}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\&{}\&{}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{`}freshFor{`}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{e1}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{False}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{canEta}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{False}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%comment: -- -}
%


%
%paragraphName: contribution continued
All the while, neither do we require a
    name supply, nor is there a risk for name capture.
    Testing terms for $ \alpha $-equivalence remains straightforward and representable
    terms are exactly those intended.
    The cost of this
    achievement is the use of somewhat more involved types for binders,
    and the use of extensions of the \textsc{Haskell} type-system. 
    The new construction is informally described and
    motivated in sec. \ref{overview}. In sections \ref{contextSec} to \ref{scopesSec}    we present in detail the implementation of the technique as well
    as basic applications.
    Larger applications (normalization using hereditary substitutions, closure conversion and
    CPS transformation) are presented in sec. \ref{examples}.
    %


\section{Overview\label{overview}}

%
%paragraphName: flow
In this section we describe our interface, but before doing so we 
    describe a simple implementation which can support this interface.%


\subsection{de{~}Bruijn Indices}

%
%paragraphName: de Bruijn indices
\Citet{de_bruijn_lambda_1972} proposed to represent an occurrence of
    some variable{~}\textcolor[rgb]{0,0,0.80}{\texttt{x}} by counting the number of binders that one
    has to cross between the occurrence and the binding site of{~}\textcolor[rgb]{0,0,0.80}{\texttt{x}}.
    A direct implementation of the idea may yield the following
    representation of untyped $ \lambda $-terms{:}%


{\nopagebreak }

%
%code:
%
%comment: data Nat = O | S Nat
%data TmB where
%  VarB :: Nat → TmB
%  AppB :: TmB → TmB → TmB
%  LamB :: TmB → TmB
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{data}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Nat}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{O}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{\textbar{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{S}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Nat}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{data}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmB}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{VarB}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Nat}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmB}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{AppB}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmB}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmB}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmB}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LamB}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmB}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmB}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: apB
Using this representation, the implementation of the application
    function{~}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}} is the following{:}%


{\nopagebreak }

%
%code:
%
%comment: apB :: TmB
%apB = LamB $ LamB $ VarB (S O) `AppB` VarB O
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{apB}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmB}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{apB}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LamB}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LamB}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{VarB}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{S}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{O}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{{`}AppB{`}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{VarB}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{O}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: no static scoping
However, such a direct implementation is cumbersome and na\"{i}ve. For
    instance it cannot statically distinguish bound and free variables.
    That is, a closed term has the same type as an open term.%


\paragraph*{Nested Abstract Syntax}

%
%paragraphName: nested data types
In functional programming languages such as \textsc{Haskell}, it is
    possible to remedy to this situation by using nested data types
    and polymorphic recursion. That is, one parameterizes the type of
    terms by a type that can represent \emph{free} variables. If the
    parameter is the empty type, terms are closed. If the parameter is
    the unit type, there is at most one free variable, etc.
    This representation is known as Nested Abstract
    Syntax{~}\cite{bellegarde-94,bird-paterson-99,altenkirch-reus-99}.%


{\nopagebreak }

%
%code:
%
%comment: data Tm a where
%  Var :: a → Tm a
%  App :: Tm a → Tm a → Tm a
%  Lam :: Tm (Succ a) → Tm a
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{data}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{App}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{Succ}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: the type of Lam
The recursive case{~}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Lam}} changes the type parameter, increasing
    its cardinality by one, since the body can refer to one more
    variable. Anticipating the amendments we propose, we define the
    type{~}\textcolor[rgb]{0,0,0.80}{\texttt{Succ}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}} as a proper sum of{~}\textcolor[rgb]{0,0,0.80}{\texttt{a}} and the unit type{~}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}    instead of{~}\textcolor[rgb]{0,0,0.80}{\texttt{Maybe}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}} as customary. Because the sum is used in an
    asymmetric fashion (the left-hand-side corresponds to variables
    bound earlier and the right-hand-side to the freshly bound one),
    we give a special definition of sum written{~}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}, whose syntax
    reflects the intended semantics.%


{\nopagebreak }

%
%code:
%
%comment: type Succ a = a :▹ ()
%
%data a :▹ v = Old a | New v
%
%bimap :: (a → a') → (v → v') →
%         (a :▹ v) → (a' :▹ v')
%bimap f _ (Old x) = Old (f x)
%bimap _ g (New x) = New (g x)
%
%untag :: a :▹ a → a
%untag (Old x) = x
%untag (New x) = x
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{type}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Succ}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{data}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{\textbar{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{bimap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a{'}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v{'}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a{'}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v{'}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{bimap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{bimap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{g}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{g}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{untag}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{untag}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{untag}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: apNested example
Using the \textcolor[rgb]{0,0,0.80}{\texttt{Tm}} representation, the implementation of the application
    function{~}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}} is the following{:}%


{\nopagebreak }

%
%code:
%
%comment: apNested :: Tm Zero
%apNested = Lam $ Lam $ Var (Old $ New ())
%                 `App` Var (New ())
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{apNested}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Zero}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{apNested}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{{`}App{`}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: the type of apNested
As promised, the type is explicit about{~}\textcolor[rgb]{0,0,0.80}{\texttt{apNested}} being a closed
    term{:} this is ensured by using the empty type{~}\textcolor[rgb]{0,0,0.80}{\texttt{Zero}} as an
    argument to{~}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}.%


{\nopagebreak }

%
%code:
%
%comment: data Zero -- no constructors
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{data}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Zero}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.63,0.13,0.94}{\texttt{\makebox[1.22ex][c]{-}\makebox[1.22ex][c]{-}\mbox{\hspace{0.50em}}no\mbox{\hspace{0.50em}}constructors}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: polymorphic terms are closed
In passing, we remark that another type which faithfully captures
    closed terms is{~}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}} --- literally{:} the type of terms which
    are meaningful in any context.
    Indeed, because{~}\textcolor[rgb]{0,0,0.80}{\texttt{a}} is universally quantified, there is no way
    to construct an inhabitant of it; therefore one cannot possibly refer to any
    free variable. In particular one can instantiate{~}\textcolor[rgb]{0,0,0.80}{\texttt{a}} to be the
    type{~}\textcolor[rgb]{0,0,0.80}{\texttt{Zero}}.%


%
%paragraphName: de Bruijn drawback
However the main drawback of using de{~}Bruijn indices remains{:} one must still
    count the number of binders between the declaration of a variable and its occurrences.%


\subsection{Referring to Bound Variables by Name}

%
%paragraphName: flow
To address the issues just touched upon, we
    propose to build $ \lambda $-abstractions with a function called{~}\textcolor[rgb]{0,0,0.80}{\texttt{lam}}. What
    matters the most is its type{:}%


{\nopagebreak }

%
%code:
%
%comment: lam :: (∀ v. v → Tm (a :▹ v)) → Tm a
%lam f = Lam (f ())
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: explain ∀ v, v →
That is, instead of adding a concrete unique type{~}(namely \textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}) in
    the recursive parameter of{~}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}, we quantify universally over a
    type variable{~}\textcolor[rgb]{0,0,0.80}{\texttt{v}} and add this type variable to the type of free
    variables. The body of the lambda-abstraction receives an arbitrary value of type{~}\textcolor[rgb]{0,0,0.80}{\texttt{v}},
    to be used at occurrences of the variable bound by{~}\textcolor[rgb]{0,0,0.80}{\texttt{lam}}.%


%
%paragraphName: const
The application function is then built as follows{:}%


{\nopagebreak }

%
%code:
%
%comment: apTm_ :: Tm Zero
%apTm_ = lam $ \ f → lam $ \ x → Var (Old (New f))
%                           `App` Var (New x)
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{apTm\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Zero}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{apTm\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.83ex][l]{ }}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{{`}App{`}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: still the same elephant
By unfolding the definition of{~}\textcolor[rgb]{0,0,0.80}{\texttt{lam}} in{~}\textcolor[rgb]{0,0,0.80}{\texttt{apTm\makebox[1.22ex][c]{\_{}}}} one recovers
    the definition of{~}\textcolor[rgb]{0,0,0.80}{\texttt{apNested}}.%


\paragraph*{Safety}

%
%paragraphName: host bindings are the spec
Using our approach, the binding structure, which can be identified as
    the \emph{specification}, is written using the host language binders.
    However at variable occurrences, de{~}Bruijn indices are still present
    in the form of the constructors \textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}} and{~}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}, and are
    purely part of the \emph{implementation}.%


%
%paragraphName: type-checking the number of Old...
The type-checker then makes sure that the implementation matches the specification{:}
    for example if one now makes a mistake and forgets one{~}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}} when entering the
    term, the \textsc{Haskell} type system rejects the definition.%


%
%comment: {- --
%


{\nopagebreak }

%
%code:
%
%comment: oops_ = lam $ \ f → lam $ \ x → Var (New f)
%                           `App` Var (New x)
%-- Couldn't match expected type `v1'
%--             with actual type `v'
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{oops\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.83ex][l]{ }}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{{`}App{`}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0.63,0.13,0.94}{\texttt{\makebox[1.22ex][c]{-}\makebox[1.22ex][c]{-}\mbox{\hspace{0.50em}}Couldn{'}t\mbox{\hspace{0.50em}}match\mbox{\hspace{0.50em}}expected\mbox{\hspace{0.50em}}type\mbox{\hspace{0.50em}}{`}v1{'}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0.63,0.13,0.94}{\texttt{\makebox[1.22ex][c]{-}\makebox[1.22ex][c]{-}\mbox{\hspace{6.50em}}with\mbox{\hspace{0.50em}}actual\mbox{\hspace{0.50em}}type\mbox{\hspace{0.50em}}{`}v{'}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%comment: -- -}
%


%
%paragraphName: no mistakes at all
In fact, if all variables are introduced with the \textcolor[rgb]{0,0,0.80}{\texttt{lam}} combinator
    the possibility of making a mistake in the
    \emph{implementation} is nonexistent, if we ignore obviously diverging terms.
    Indeed, because the type{~}\textcolor[rgb]{0,0,0.80}{\texttt{v}} corresponding to a bound variable is
    universally quantified, the only way to construct a value of its
    type is to use the variable bound by{~}\textcolor[rgb]{0,0,0.80}{\texttt{lam}}. (In \textsc{Haskell}    one can use a diverging program; however one has to make a conscious decision 
    to produce a value of such an obviously empty type.)%


%
%paragraphName: unicity of injections
In general, in a closed context, if one considers the
    expression{~}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[0.61ex][l]{\textsuperscript{n}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}, only one possible value
    of{~}\textcolor[rgb]{0,0,0.80}{\texttt{n}} is admissible. Indeed, anywhere in the formation of a term
    using{~}\textcolor[rgb]{0,0,0.80}{\texttt{lam}}, the type of variables is{~}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a\makebox[0.61ex][l]{$ _{{0}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{0}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{1}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \cdots $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{n}} $}}}    where{~}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{0}} $}}}, \textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{1}} $}}}, $ \ldots $ , \textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{n}} $}}} are all distinct and universally
    quantified, and none of them occurs as part of{~}\textcolor[rgb]{0,0,0.80}{\texttt{a\makebox[0.61ex][l]{$ _{{0}} $}}}. Hence, there
    is only one injection function from a given{~}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{i}} $}}} to{~}\textcolor[rgb]{0,0,0.80}{\texttt{a}}.%


\paragraph*{Auto-Inject}

%
%paragraphName: auto-inject
Knowing that the injection functions are uniquely determined by
    their type, one may wish to infer them mechanically. Thanks 
    the powerful instance search mechanism implemented in GHC, this
    is feasible. To this effect, we define a class{~}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \in $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}} capturing that{~}\textcolor[rgb]{0,0,0.80}{\texttt{v}}    occurs as part of a context{~}\textcolor[rgb]{0,0,0.80}{\texttt{a}}{:}%


{\nopagebreak }

%
%code:
%
%comment: class v :∈ a where
%  inj :: v → a
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{class}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \in $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{inj}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: var
We can then wrap the injection function and{~}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Var}} in a convenient
    package{:}%


%
%comment: {- --
%


{\nopagebreak }

%
%code:
%
%comment: var :: ∀ v a. (v :∈ a) ⇒ v → Tm a
%var = Var . inj
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \in $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{inj}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%comment: -- -}
%


%
%paragraphName: apTm
and the application function can be conveniently written{:}%


{\nopagebreak }

%
%code:
%
%comment: -- Building the following term: \ f x → f x
%apTm = lam $ \ f → lam $ \ x → var f `App` var x
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0.63,0.13,0.94}{\texttt{\makebox[1.22ex][c]{-}\makebox[1.22ex][c]{-}\mbox{\hspace{0.50em}}Building\mbox{\hspace{0.50em}}the\mbox{\hspace{0.50em}}following\mbox{\hspace{0.50em}}term{:}\mbox{\hspace{0.50em}}$ \lambda $\mbox{\hspace{0.50em}}f\mbox{\hspace{0.50em}}x\mbox{\hspace{0.50em}}$ \rightarrow $\mbox{\hspace{0.50em}}f\mbox{\hspace{0.50em}}x}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{apTm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{{`}App{`}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: more intuitions
In a nutshell, our de{~}Bruijn indices are typed with the context
    where they are valid. If that context is sufficiently polymorphic,
    they can not be mistakenly used in a wrong context. Another
    intuition is that \textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}} and{~}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}} are building proofs
    of {``}context membership{''}. Thus, when a de{~}Bruijn index is given a maximally polymorphic context,
    it is similar to a well-scoped name.%


%
%paragraphName: flow to next section
So far, we have seen that by taking advantage of polymorphism, 
    our interface allows to construct
    terms with de{~}Bruijn indices, combined with the safety and
    convenience of named variables. In the next section we show how
    to use the same idea to provide the same advantages for the analysis
    and manipulation of terms.%


\subsection{Referring to Free Variables by Name}

%
%paragraphName: unpack
Often, one wants to be able to check if an
    occurrence of a variable is a reference to some previously bound
    variable. With de{~}Bruijn indices, one must (yet again) count the
    number of binders traversed between the variable bindings and
    its potential occurrences --- an error prone task. Here as well,
    we can take advantage of polymorphism to ensure that no mistake
    happens. We provide a combinator{~}\textcolor[rgb]{0,0,0.80}{\texttt{unpack}}, which hides the 
    type of the newly bound variables (the type{~}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}) as an existentially
    quantified type{~}\textcolor[rgb]{0,0,0.80}{\texttt{v}}. The combinator{~}\textcolor[rgb]{0,0,0.80}{\texttt{unpack}} takes a binding
    structure (of type{~}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{Succ}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}) and gives a pair of
    a value{~}\textcolor[rgb]{0,0,0.80}{\texttt{x}} of type{~}\textcolor[rgb]{0,0,0.80}{\texttt{v}} and a
    sub-term of type{~}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}. Here we represent the existential using
    continuation-passing style instead of a data-type, as it appears more convenient to use
    this way. 
    Because this combinator is not specific to our
    type{~}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}} we generalize it to any type constructor{~}\textcolor[rgb]{0,0,0.80}{\texttt{f}}{:}%


{\nopagebreak }

%
%code:
%
%comment: unpack :: f (Succ a) →
%          (∀ v. v → f (a :▹ v) → r) → r
%unpack e k = k () e
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{unpack}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{Succ}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{r}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{r}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{unpack}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{e}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{k}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{k}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{e}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: why unpack works
Because{~}\textcolor[rgb]{0,0,0.80}{\texttt{v}} is existentially bound, \textcolor[rgb]{0,0,0.80}{\texttt{x}} can never be used in a
    computation. It only acts as a reference to a variable in a context,
    in a way which is only accessible to the type-checker.
    For instance, when facing a term{~}\textcolor[rgb]{0,0,0.80}{\texttt{t}} of type
    \textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{0}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{1}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}, \textcolor[rgb]{0,0,0.80}{\texttt{x}} refers to the last introduced free
    variable in{~}\textcolor[rgb]{0,0,0.80}{\texttt{t}}.
    Using{~}\textcolor[rgb]{0,0,0.80}{\texttt{unpack}}, one can write a function which can recognize an
    eta-contractible term as follows{:} (Recall that an a eta-contractible
    term has the form{~}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{e}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}, where{~}\textcolor[rgb]{0,0,0.80}{\texttt{x}} does not occur free
    in{~}\textcolor[rgb]{0,0,0.80}{\texttt{e}}.)%


{\nopagebreak }

%
%code:
%
%comment: canEta :: Tm Zero → Bool
%canEta (Lam e) = unpack e $ \ x t → case t of
%  App e1 (Var y) → y `isOccurrenceOf` x &&
%                    x `freshFor` e1
%  _ → False
%canEta _ = False
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{canEta}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Zero}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Bool}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{canEta}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{e}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{unpack}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{e}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{case}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{of}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{App}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{e1}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{`}isOccurrenceOf{`}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\&{}\&{}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{`}freshFor{`}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{e1}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{False}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{canEta}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{False}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: canEta
In the above example, the two functions{~}\textcolor[rgb]{0,0,0.80}{\texttt{isOccurrenceOf}}    and{~}\textcolor[rgb]{0,0,0.80}{\texttt{freshFor}} use the{~}\textcolor[rgb]{0,0,0.80}{\texttt{inj}} function to lift{~}\textcolor[rgb]{0,0,0.80}{\texttt{x}} to
    a reference in the right context before comparing it to the
    occurrences. The calls to these functions do not get more complicated
    in the presence of multiple binders. For example, the code which
    recognizes the pattern{~}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{e}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}} is as follows{:}%


{\nopagebreak }

%
%code:
%
%comment: recognize :: Tm Zero → Bool
%recognize t0 = case t0 of
%    Lam f → unpack f $ \ x t1 → case t1 of
%      Lam g → unpack g $ \ y t2 → case t2 of
%        App e1 (Var y) → y `isOccurrenceOf` x &&
%                          x `freshFor` e1
%        _ → False
%      _ → False
%    _ → False
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{recognize}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Zero}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Bool}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{recognize}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t0}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{case}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t0}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{of}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{unpack}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t1}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{case}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t1}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{of}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{g}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{unpack}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{g}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t2}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{case}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t2}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{of}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{App}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{e1}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{`}isOccurrenceOf{`}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\&{}\&{}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{`}freshFor{`}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{e1}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{False}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{False}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{False}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: slogan
Again, even though variables are represented by mere indices, the use
    of polymorphism allows the user to refer to them by name, using the instance
    search mechanism to fill in the details of implementation.%


\paragraph*{Pack}

%
%paragraphName: pack
It is easy to invert the job
    of{~}\textcolor[rgb]{0,0,0.80}{\texttt{unpack}}. Indeed, given a value{~}\textcolor[rgb]{0,0,0.80}{\texttt{x}} of type{~}\textcolor[rgb]{0,0,0.80}{\texttt{v}} and a term
    of type \textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}} one can reconstruct a binder as follows{:} %


{\nopagebreak }

%
%code:
%
%comment: pack :: Functor tm ⇒ v → tm (a :▹ v) → tm (Succ a)
%pack x = fmap (bimap id (const ()))
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{pack}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Functor}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{Succ}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{pack}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{bimap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{const}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
(The \textcolor[rgb]{0,0,0.80}{\texttt{Functor}} constraint is harmless, as we will see in sec. \ref{termStructure}.)
    As we can see, the value{~}\textcolor[rgb]{0,0,0.80}{\texttt{x}} is not used by pack. However it
    statically helps as a specification of the user intention{:} it makes sure
    the programmer relies on host-level variable names, and not indices.%


%
%paragraphName:
A production-quality version of \textcolor[rgb]{0,0,0.80}{\texttt{pack}} would allow to bind any 
    free variable. Writing the constraint \textcolor[rgb]{0,0,0.80}{\texttt{Insert}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}} to mean 
    that by removing the variable \textcolor[rgb]{0,0,0.80}{\texttt{v}} 
    from the context \textcolor[rgb]{0,0,0.80}{\texttt{b}} one obtains \textcolor[rgb]{0,0,0.80}{\texttt{a}}, then a generic \textcolor[rgb]{0,0,0.80}{\texttt{pack}} would have the 
    following type{:}%


{\nopagebreak }

%
%code:
%
%comment: packGen :: ∀ f v a b w. (Functor f, Insert v a b) ⇒
%           v → f b → (w → f (a :▹ w))
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{packGen}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{w}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{Functor}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f,}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Insert}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{w}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{w}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
The implementation of \textcolor[rgb]{0,0,0.80}{\texttt{packGen}} and \textcolor[rgb]{0,0,0.80}{\texttt{Insert}} is a straightforward extension of \textcolor[rgb]{0,0,0.80}{\texttt{inj}} and \textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \in $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}},
     but it does not fit here, so we defer it to the appendix.%


%
%paragraphName: lamP
In sum, the{~}\textcolor[rgb]{0,0,0.80}{\texttt{pack}} combinator makes it possible to give a nominal-style
    interface to binders. For example an alternative way to build
    the{~}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Lam}} constructor is the following{:}%


{\nopagebreak }

%
%code:
%
%comment: lamP :: v → Tm (a :▹ v) → Tm a
%lamP x t = Lam (pack x t)
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{lamP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{lamP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{pack}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


\section{Contexts\label{contextSec}}

%
%paragraphName: flow
Having introduced our interface informally, we now begin a
           systematic description of is realization and the concepts it builds upon.%


%
%paragraphName: flow, ▹
We have seen that the type of free variables essentially describes
    the context where they are meaningful. A context can either be
    empty (and we represent it by the type{~}\textcolor[rgb]{0,0,0.80}{\texttt{Zero}}) or not (which we
    can represent by the type{~}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}).%


%
%paragraphName: explain remove
An important function of the{~}\textcolor[rgb]{0,0,0.80}{\texttt{v}} type variable is to make sure
    programmers refer to the variable they intend to. For example,
    consider the following function, which takes a list of (free)
    variables and removes one of them from the list. It takes a list
    of variables in the context{~}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}} and returns a list in the
    context{~}\textcolor[rgb]{0,0,0.80}{\texttt{a}}. For extra safety, it also takes the name of the
    variable being removed, which is used only for type-checking
    purposes.%


{\nopagebreak }

%
%code:
%
%comment: remove :: v → [a :▹ v] → [a]
%remove _ xs = [x | Old x ← xs]
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{remove}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{[}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{]}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{[}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{]}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{remove}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{xs}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{[}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{\textbar{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \leftarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{xs}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{]}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: explain freeVars
The function which computes the list of occurrences of free variables in a term can
    be directly transcribed from its nominal-style definition, thanks
    to the{~}\textcolor[rgb]{0,0,0.80}{\texttt{unpack}} combinator.%


{\nopagebreak }

%
%code:
%
%comment: freeVars :: Tm a → [a]
%freeVars (Var x) = [x]
%freeVars (Lam b) = unpack b $ \ x t →
%   remove x (freeVars t)
%freeVars (App f a) = freeVars f ++ freeVars a
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{freeVars}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{[}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{]}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{freeVars}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{[}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{]}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{freeVars}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{unpack}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{remove}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{freeVars}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{freeVars}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{App}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{freeVars}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{++}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{freeVars}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


\subsection{Names Are Polymorphic Indices}

%
%paragraphName: Eq Zero
Checking whether two names are equal or not is necessary to implement a large 
    class of term manipulation functions.
    To implement comparison between names, we provide the following two{~}\textcolor[rgb]{0,0,0.80}{\texttt{Eq}} instances.
    First, the{~}\textcolor[rgb]{0,0,0.80}{\texttt{Zero}} type is vacuously equipped with equality{:}%


{\nopagebreak }

%
%code:
%
%comment: instance Eq Zero where
%  (==) = magic
%
%magic :: Zero → a
%magic _ = error "impossible"
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{instance}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Eq}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Zero}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\char `\=}{\char `\=}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{magic}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{magic}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Zero}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{magic}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{error}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{"impossible"}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
Second, if two indices refer to the first variable they are equal;
    otherwise we recurse. We stress that this equality inspects only the
    \emph{indices}, not the values contained in the type. For
    example{~}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{0}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\char `\=}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{1}} is{~}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{True}}{:}%


{\nopagebreak }

%
%code:
%
%comment: instance Eq a ⇒ Eq (a :▹ v) where
%  New _ == New _ = True
%  Old x == Old y = x == y
%  _     == _     = False
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{instance}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Eq}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Eq}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\char `\=}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{True}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\char `\=}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\char `\=}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\char `\=}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{False}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
    Comparing naked de{~}Bruijn indices for equality is an error prone operation, 
    because one index might be valid in
    a context different from the other, and thus an arbitrary adjustment might be required.
    With Nested Abstract Syntax, the situation improves{:} by requiring equality to be 
    performed between indices of the same type, a whole class of errors are prevented by
    type-checking. Some mistakes are possible though{:} given a index of type \textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}},
    a swap the last two variables might be the right thing to do, but one cannot decide if it is so 
    from the types only.
    By making the contexts fully
    polymorphic as we propose, no mistake is possible. 
    Hence the slogan{:} names are polymorphic indices.%


%
%paragraphName:
Consequently, the derived equality instance of{~}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}} gives
    $ \alpha $-equality, and is guaranteed safe in fully-polymorphic contexts.%


\subsection{Membership}

%
%paragraphName:
Given the above representation of contexts, we can implement
    the relation of context membership by a type class{~}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \in $}}}, whose
    sole method performs the injection from a member of the context to
    the full context. The relation is defined by two inference rules,
    corresponding to finding the variable in the first position of the
    context, or further away in it, with the necessary injections{:}%


{\nopagebreak }

%
%code:
%
%comment: instance v :∈ (a :▹ v) where
%  inj = New
%
%instance (v :∈ a) ⇒ v :∈ (a :▹ v') where
%  inj = Old . inj
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{instance}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \in $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{inj}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{instance}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \in $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \in $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v{'}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{inj}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{inj}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: incoherent instances
The cognoscenti will recognize the two above instances as
    \emph{incoherent}, that is, if{~}\textcolor[rgb]{0,0,0.80}{\texttt{v}} and{~}\textcolor[rgb]{0,0,0.80}{\texttt{v{'}}} were instantiated
    to the same type, both instances would apply, but the injections would be different. Fortunately,
    this incoherence never triggers as long as one keeps the contexts
    maximally polymorphic contexts{:} \textcolor[rgb]{0,0,0.80}{\texttt{v}} and{~}\textcolor[rgb]{0,0,0.80}{\texttt{v{'}}} will always be
    different.%


%
%paragraphName: inj enables var
We have seen before that the overloading of the{~}\textcolor[rgb]{0,0,0.80}{\texttt{inj}} function
    in the type class{~}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \in $}}} allows to automatically convert a type-level
    reference to a term into a properly tagged de{~}Bruijn index, namely
    the function{~}\textcolor[rgb]{0,0,0.80}{\texttt{var}}.%


%
%paragraphName: explain isOccurrenceOf
Conversely, one can implement occurrence-check by combining  \textcolor[rgb]{0,0,0.80}{\texttt{inj}} with \textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\char `\=}{\char `\=}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}{:}
    one first lifts the bound variable to the context of the chosen occurrence and
    then tests for equality.%


{\nopagebreak }

%
%code:
%
%comment: isOccurrenceOf :: (Eq a, v :∈ a) ⇒ a → v → Bool
%x `isOccurrenceOf` y = x == inj y
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{isOccurrenceOf}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{Eq}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a,}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \in $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Bool}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{`}isOccurrenceOf{`}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\char `\=}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{inj}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: occursIn
One can test if a variable is fresh for a given term as follows{:}%


{\nopagebreak }

%
%code:
%
%comment: freshFor :: (Eq a, v :∈ a) ⇒ v → Tm a → Bool
%x `freshFor` t = not (inj x `elem` freeVars t)
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{freshFor}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{Eq}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a,}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \in $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Bool}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{`}freshFor{`}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{not}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{inj}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{`}elem{`}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{freeVars}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


\subsection{Inclusion}

%
%paragraphName: context inclusion, ⊆
Another useful relation is context inclusion between contexts, which we also
    represent by a type class, named{~}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.83ex][c]{$ \subseteq $}}}. The sole method of the
    typeclass is again an injection, from the small context to the
    bigger one. The main application of \textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.83ex][c]{$ \subseteq $}}} is in term weakening,
    presented at the end of sec. \ref{functorSec}.%


{\nopagebreak }

%
%code:
%
%comment: class a :⊆ b where
%  injMany :: a → b
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{class}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.83ex][c]{$ \subseteq $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{injMany}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: ⊆ instances
This time we have four instances{:} inclusion is reflexive; the empty
    context is the smallest one; adding a variable makes the context
    larger; and variable append{~}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}} is monotonic for inclusion.%


{\nopagebreak }

%
%code:
%
%comment: instance a :⊆ a where injMany = id
%
%instance Zero :⊆ a where injMany = magic
%
%instance (a :⊆ b) ⇒ a :⊆ (b :▹ v) where
%  injMany = Old . injMany
%
%instance (a :⊆ b) ⇒ (a :▹ v) :⊆ (b :▹ v) where
%  injMany = bimap injMany id
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{instance}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.83ex][c]{$ \subseteq $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{injMany}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{instance}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Zero}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.83ex][c]{$ \subseteq $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{injMany}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{magic}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{instance}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.83ex][c]{$ \subseteq $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.83ex][c]{$ \subseteq $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{injMany}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{injMany}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{instance}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.83ex][c]{$ \subseteq $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.83ex][c]{$ \subseteq $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{injMany}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{bimap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{injMany}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: (▹) functoriality
This last case uses the fact that{~}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}} is functorial in its first argument.%


\section{Term Structure\label{termStructure}}

%
%paragraphName: motivation
It is well-known that every term representation parameterized
    on the type of free variables should exhibit monadic structure,
    with substitution corresponding to the binding operator \cite{bellegarde-94,bird-paterson-99,altenkirch-reus-99}. That is, a{~}\textcolor[rgb]{0,0,0.80}{\texttt{Monad}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}} constraint means that a that
    a term representation{~}\textcolor[rgb]{0,0,0.80}{\texttt{tm}} is stable under substitution. In
    this section we review this structure, as well as other standard
    related structures on terms. These structures are perhaps easier
    to implement directly on a concrete term representation, rather
    than our interface. However, we give an implementation solely based
    on it, to demonstrate that it is complete with respect to these
    structures. By doing so, we also illustrate how to work with our
    interface in practice.%


\subsection{Renaming and Functors\label{functorSec}}

%
%paragraphName: intro functor
The first, perhaps simplest, property of terms is that free
    variables can be renamed. This property is captured by
    the{~}\textcolor[rgb]{0,0,0.80}{\texttt{Functor}} structure.%


%
%paragraphName: describe Functor Tm
The {``}renaming{''} to apply is given as a function{~}\textcolor[rgb]{0,0,0.80}{\texttt{f}} from{~}\textcolor[rgb]{0,0,0.80}{\texttt{a}}    to{~}\textcolor[rgb]{0,0,0.80}{\texttt{b}} where{~}\textcolor[rgb]{0,0,0.80}{\texttt{a}} is the type of free variables of the input
    term{~}(\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}) and{~}\textcolor[rgb]{0,0,0.80}{\texttt{b}} is the type of free variables of the
    {``}renamed{''} term{~}(\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}). While the function \textcolor[rgb]{0,0,0.80}{\texttt{f}} should be injective
    to be considered a renaming, the functor instance
    works well for any function{~}\textcolor[rgb]{0,0,0.80}{\texttt{f}}. The renaming operation then
    simply preserves the structure of the input term. At occurrence
    sites it uses{~}\textcolor[rgb]{0,0,0.80}{\texttt{f}} to rename free variables. At binding sites,
    \textcolor[rgb]{0,0,0.80}{\texttt{f}} is upgraded from{~}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}} to{~}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}} using
    the functoriality of{~}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}} with{~}\textcolor[rgb]{0,0,0.80}{\texttt{bimap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}. Adapting the
    function{~}\textcolor[rgb]{0,0,0.80}{\texttt{f}} is necessary to protect the bound name from being
    altered by{~}\textcolor[rgb]{0,0,0.80}{\texttt{f}}, and thanks to our use of polymorphism, the
    type-checker ensures that we make no mistake in doing so.%


{\nopagebreak }

%
%code:
%
%comment: instance Functor Tm where
%  fmap f (Var x)   = Var (f x)
%  fmap f (Lam b)   = unpack b $ \ x t →
%                       lamP x $ fmap (bimap f id) t
%  fmap f (App t u) = App (fmap f t) (fmap f u)
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{instance}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Functor}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{unpack}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{lamP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{bimap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{App}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{u}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{App}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{u}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: functor laws
As usual satisfying functor laws implies that the structure is
    preserved by the functor action (\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}). The type for terms being
    a functor therefore means that applying a renaming is going to only
    affect the free variables and leave the structure untouched. That is,
    whatever the function{~}\textcolor[rgb]{0,0,0.80}{\texttt{f}} is doing, the bound names are not
    changing. The \textcolor[rgb]{0,0,0.80}{\texttt{Functor}} laws are the following{:}%


%
%comment: {- --
%


{\nopagebreak }

%
%code:
%
%comment: fmap id ≡ id
%fmap (f . g) ≡ fmap f . fmap g
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \equiv $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{g}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \equiv $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{g}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%comment: -- -}
%


%
%paragraphName: reading the laws
In terms of renaming, they mean that the identity function corresponds
    to not renaming anything
    and compositions of renaming functions corresponds to two sequential
    renaming operations.%


%
%paragraphName:
Assuming only a functor structure, it is possible to write useful
    functions on terms which involve only renaming. A couple of examples
    follow.%


%
%paragraphName:
First, let us assume an equality test on free variables. 
    We can then write a function
    \textcolor[rgb]{0,0,0.80}{\texttt{rename}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{x,y}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}} which replaces free occurrences of{~}\textcolor[rgb]{0,0,0.80}{\texttt{x}} in{~}\textcolor[rgb]{0,0,0.80}{\texttt{t}}    by{~}\textcolor[rgb]{0,0,0.80}{\texttt{y}} and{~}\textcolor[rgb]{0,0,0.80}{\texttt{swap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{x,y}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}} which exchanges free occurrences
    of{~}\textcolor[rgb]{0,0,0.80}{\texttt{x}} and{~}\textcolor[rgb]{0,0,0.80}{\texttt{y}} in{~}\textcolor[rgb]{0,0,0.80}{\texttt{t}}.%


{\nopagebreak }

%
%code:
%
%comment: rename0 :: Eq a ⇒ (a, a) → a → a
%rename0 (x,y) z | z == x    = y
%                | otherwise = z
%
%rename :: (Functor f, Eq a) ⇒ (a, a) → f a → f a
%rename = fmap . rename0
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{rename0}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Eq}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a,}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{rename0}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{x,y}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{z}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{\textbar{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{z}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\char `\=}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{\textbar{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{otherwise}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{z}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{rename}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{Functor}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f,}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Eq}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a,}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{rename}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{rename0}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%code:
{\noindent}%
%comment: swap0 :: Eq a ⇒ (a, a) → a → a
%swap0 (x,y) z | z == y    = x
%              | z == x    = y
%              | otherwise = z
%
%swap :: (Functor f, Eq a) ⇒ (a, a) → f a → f a
%swap = fmap . swap0
%
\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{swap0}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Eq}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a,}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{swap0}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{x,y}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{z}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{\textbar{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{z}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\char `\=}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{\textbar{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{z}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\char `\=}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{\textbar{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{otherwise}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{z}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{swap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{Functor}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f,}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Eq}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a,}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{swap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{swap0}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: auto-weakening
Second, let us assume two arguments{~}\textcolor[rgb]{0,0,0.80}{\texttt{a}} and{~}\textcolor[rgb]{0,0,0.80}{\texttt{b}} related by the
    type class{~}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.83ex][c]{$ \subseteq $}}}. Thus we have{~}\textcolor[rgb]{0,0,0.80}{\texttt{injMany}} of type{~}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}, which
    can be seen as a renaming of free variables via the functorial
    structure of terms. By applying{~}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}} to it, one obtains
    an arbitrary weakening from the context{~}\textcolor[rgb]{0,0,0.80}{\texttt{a}} to the bigger
    context{~}\textcolor[rgb]{0,0,0.80}{\texttt{b}}.%


{\nopagebreak }

%
%code:
%
%comment: wk :: (Functor f, a :⊆ b) ⇒ f a → f b
%wk = fmap injMany
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{wk}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{Functor}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f,}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.83ex][c]{$ \subseteq $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{wk}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{injMany}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
Again, this arbitrary weakening function relieves the programmer from
    tediously counting indices and constructing an appropriate renaming function. We
    demonstrate this feature in sec. \ref{examples}.%


\subsection{Substitution and Monads\label{monadSec}}

%
%paragraphName:
Another useful property of terms is that they can be substituted for free variables in
    other terms. This property is captured algebraically by asserting
    that terms form a{~}\textcolor[rgb]{0,0,0.80}{\texttt{Monad}}, where \textcolor[rgb]{0,0,0.80}{\texttt{return}} is the variable
    constructor and{~}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}} acts as parallel substitution. Indeed, one
    can see a substitution from a context{~}\textcolor[rgb]{0,0,0.80}{\texttt{a}} to a context{~}\textcolor[rgb]{0,0,0.80}{\texttt{b}} as
    mapping from{~}\textcolor[rgb]{0,0,0.80}{\texttt{a}} to{~}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}, (technically a morphism in the associated Kleisli
    category) and{~}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}} applies a substitution everywhere in a term.%


%
%paragraphName:
The definition of the{~}\textcolor[rgb]{0,0,0.80}{\texttt{Monad}} instance is straightforward for
    variable and application, and we isolate the handling of binders in
    the{~}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}} function.%


{\nopagebreak }

%
%code:
%
%comment: instance Monad Tm where
%  return = Var
%  Var x   >>= θ = θ x
%  Lam s   >>= θ = Lam (s >>>= θ)
%  App t u >>= θ = App (t >>= θ) (u >>= θ)
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{instance}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Monad}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{return}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Var}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{s}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{s}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{App}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{u}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{App}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{u}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
At binding sites, one needs to lift the substitution so that it does not
    act on the newly bound variables, a behavior isolated in the helper \textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}. As for the{~}\textcolor[rgb]{0,0,0.80}{\texttt{Functor}} instance,
    the type system guarantees that no mistake is made. Perhaps
    noteworthy is that this operation is independent of the concrete
    term structure{:} we only {``}rename{''} with{~}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}} and inject variables
    with{~}\textcolor[rgb]{0,0,0.80}{\texttt{return}}.%


{\nopagebreak }

%
%code:
%
%comment: liftSubst :: (Functor tm, Monad tm) ⇒
%          v → (a → tm b) → (a :▹ v) → tm (b :▹ v)
%liftSubst _ θ (Old x) = fmap Old (θ x)
%liftSubst _ θ (New x) = return (New x)
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{liftSubst}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{Functor}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm,}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Monad}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{liftSubst}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{liftSubst}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{return}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
Substitution under a binder{~}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}} is then the wrapping
    of{~}\textcolor[rgb]{0,0,0.80}{\texttt{liftSubst}} between{~}\textcolor[rgb]{0,0,0.80}{\texttt{unpack}} and{~}\textcolor[rgb]{0,0,0.80}{\texttt{pack}}. It is uniform as
    well, and thus can be reused for every structure with binders.%


{\nopagebreak }

%
%code:
%
%comment: (>>>=) :: (Functor tm, Monad tm) ⇒
%          tm (Succ a) → (a → tm b) → tm (Succ b)
%s >>>= θ = unpack s $ \ x t →
%             pack x (t >>= liftSubst x θ)
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{Functor}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm,}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Monad}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{Succ}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{Succ}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{s}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{unpack}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{s}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{pack}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{liftSubst}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: laws
For terms, the meaning of the monad laws can be interpreted as follows.
    The associativity law ensures that applying a composition of
    substitutions is equivalent to sequentially applying them, while the
    identity laws ensure that variables act indeed as such.%


%
%paragraphName:
We can write useful functions for terms based only on the \textcolor[rgb]{0,0,0.80}{\texttt{Monad}} structure. 
    For example, given the membership (\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \in $}}}), one can provide the a
    generic combinator to reference to a variable within any term structure{:}%


{\nopagebreak }

%
%code:
%
%comment: var :: (Monad tm, v :∈ a) ⇒ v → tm a
%var = return . inj
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{Monad}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm,}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \in $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{return}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{inj}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
One can also substitute an arbitrary variable{:}%


{\nopagebreak }

%
%code:
%
%comment: substitute :: (Monad tm, Eq a, v :∈ a) ⇒
%              v → tm a → tm a → tm a
%substitute x t u = u >>= \ y →
%     if y `isOccurrenceOf` x then t else return y
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{substitute}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{Monad}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm,}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Eq}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a,}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \in $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{substitute}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{u}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{u}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{if}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{`}isOccurrenceOf{`}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{then}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{else}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{return}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
One might however also want to remove the substituted
    variable from the context while performing the substitution{:}%


{\nopagebreak }

%
%code:
%
%comment: substituteOut :: Monad tm ⇒
%                 v → tm a → tm (a :▹ v) → tm a
%substituteOut x t u = u >>= \ y → case y of
%     New _ → t
%     Old x → return x
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{substituteOut}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Monad}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{substituteOut}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{u}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{u}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{case}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{of}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{return}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


\subsection{Traversable}

%
%paragraphName: explain traverse
Functors enable to apply any pure function{~}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}} to the
    elements of a structure to get a new structure holding the images
    of{~}\textcolor[rgb]{0,0,0.80}{\texttt{f}}. Traversable structures enable to apply an effectful
    function{~}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{m}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}} where{~}\textcolor[rgb]{0,0,0.80}{\texttt{m}} can be any{~}\textcolor[rgb]{0,0,0.80}{\texttt{Applicative}}    functor. An{~}\textcolor[rgb]{0,0,0.80}{\texttt{Applicative}} functor is strictly more powerful
    than a{~}\textcolor[rgb]{0,0,0.80}{\texttt{Functor}} and strictly less powerful than a{~}\textcolor[rgb]{0,0,0.80}{\texttt{Monad}}.
    Any{~}\textcolor[rgb]{0,0,0.80}{\texttt{Monad}} is an{~}\textcolor[rgb]{0,0,0.80}{\texttt{Applicative}} and any{~}\textcolor[rgb]{0,0,0.80}{\texttt{Applicative}}    is a{~}\textcolor[rgb]{0,0,0.80}{\texttt{Functor}}. To be traversed a structure only needs
    an applicative and therefore support monadic actions
    directly{~}\cite{mcbride_applicative_2007}.%


{\nopagebreak }

%
%code:
%
%comment: instance Traversable Tm where
%  traverse f (Var x)   = Var <$> f x
%  traverse f (App t u) =
%    App <$> traverse f t <*> traverse f u
%  traverse f (Lam t)   =
%    unpack t $ \ x b →
%      lamP x <$> traverse (bitraverse f pure) b
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{instance}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Traversable}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{traverse}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textless{}}\${}\makebox[1.22ex][c]{\textgreater{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{traverse}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{App}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{u}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{App}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textless{}}\${}\makebox[1.22ex][c]{\textgreater{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{traverse}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textless{}}*\makebox[1.22ex][c]{\textgreater{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{traverse}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{u}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{traverse}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{unpack}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{lamP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textless{}}\${}\makebox[1.22ex][c]{\textgreater{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{traverse}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{bitraverse}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{pure}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: explain bitraverse
In order to traverse name abstractions, indices need to be traversed
    as well. The type{~}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}} is a bi-functor and is bi-traversable.
    The function{~}\textcolor[rgb]{0,0,0.80}{\texttt{bitraverse}} is given two effectful functions, one for
    each case{:}%


{\nopagebreak }

%
%code:
%
%comment: bitraverse :: Functor f ⇒ (a     → f a')
%                        → (b     → f b')
%                        → (a :▹ b → f (a' :▹ b'))
%bitraverse f _ (Old x) = Old <$> f x
%bitraverse _ g (New x) = New <$> g x
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{bitraverse}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Functor}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a{'}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b{'}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a{'}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b{'}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{bitraverse}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textless{}}\${}\makebox[1.22ex][c]{\textgreater{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{bitraverse}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{g}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textless{}}\${}\makebox[1.22ex][c]{\textgreater{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{g}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
An example of a useful effect to apply is throwing an exception,
    implemented for example as the \textcolor[rgb]{0,0,0.80}{\texttt{Maybe}} monad. If a term has no
    free variable, then it can be converted from the type{~}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}    to{~}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Zero}} (or equivalently{~}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}), but this requires a dynamic
    check. It may seem like a complicated implementation is necessary,
    but in fact it is a direct application of the{~}\textcolor[rgb]{0,0,0.80}{\texttt{traverse}}    function.%


{\nopagebreak }

%
%code:
%
%comment: closed :: Traversable tm ⇒ tm a → Maybe (tm b)
%closed = traverse (const Nothing)
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{closed}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Traversable}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Maybe}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{closed}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{traverse}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{const}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Nothing}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: freeVars is toList
Thanks to terms being an instance of{~}\textcolor[rgb]{0,0,0.80}{\texttt{Traversable}} they are
    also{~}\textcolor[rgb]{0,0,0.80}{\texttt{Foldable}} meaning that we can combine all the elements of
    the structure (i.e. the occurrences of free variables in the term)
    using any{~}\textcolor[rgb]{0,0,0.80}{\texttt{Monoid}}. One particular monoid is the free monoid of
    lists. Consequently, \textcolor[rgb]{0,0,0.80}{\texttt{Data.Foldable.toList}} is computing the
    free variables of a term and{~}\textcolor[rgb]{0,0,0.80}{\texttt{Data.Foldable.elem}} can be used to
    build{~}\textcolor[rgb]{0,0,0.80}{\texttt{freshFor}}{:}%


{\nopagebreak }

%
%code:
%
%comment: freeVars' :: Tm a → [a]
%freeVars' = toList
%
%freshFor' :: (Eq a, v :∈ a) ⇒ v → Tm a → Bool
%x `freshFor'` t = not (inj x `elem` t)
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{freeVars{'}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{[}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{]}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{freeVars{'}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{toList}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{freshFor{'}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{Eq}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a,}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \in $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Bool}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{`}freshFor{'}{`}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{not}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{inj}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{`}elem{`}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


\section{Scopes\label{scopesSec}}

%
%paragraphName: flow
  Armed with an intuitive understanding of safe interfaces to manipulate de{~}Bruijn indices, 
  and the knowledge that one can abstract over any 
  substitutive structure by using standard type-classes, we can recapitulate and succinctly describe
  the essence of our constructions.%


%
%paragraphName:
In Nested Abstract Syntax, a binder introducing one variable in scope, for an arbitrary term structure \textcolor[rgb]{0,0,0.80}{\texttt{tm}}    is represented as follows{:}%


{\nopagebreak }

%
%code:
%
%comment: type SuccScope tm a = tm (Succ a)
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{type}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{SuccScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{Succ}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
In essence, we propose two new, dual representations of binders,
                                             one based on universal
  quantification, the other one based on existential quantification.%


%
%comment: {- --
%


{\nopagebreak }

%
%code:
%
%comment: type UnivScope  tm a = ∀ v.  v → tm (a :▹ v)
%type ExistScope tm a = ∃ v. (v ,  tm (a :▹ v))
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{type}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{UnivScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{type}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{ExistScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \exists $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{,}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%comment: -- -}
%


%
%paragraphName:
The above syntax for existentials is not supported in \textsc{Haskell}, so we must use
    one of the lightweight encodings available. In the absence of view patterns,   
    a CPS encoding is
    convenient for programming (so we used this so far),
    but a datatype representation is more convenient when dealing with scopes only{:}%


{\nopagebreak }

%
%code:
%
%comment: data ExistScope tm a where
%  E :: v → tm (a :▹ v) → ExistScope tm a
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{data}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{ExistScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{E}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{ExistScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
As we have observed on a number of examples, these representations
    are dual from a usage perspective{:} the universal-based representation
    allows safe the construction of terms, while the existential-based representation 
    allows safe analysis of terms.
    Strictly speaking, safety holds only if one disregards non-termination and \textcolor[rgb]{0,0,0.80}{\texttt{seq}}, 
    but because the
    values of type \textcolor[rgb]{0,0,0.80}{\texttt{v}} are never used for computation, mistakenly using a
    diverging term in place of a witness
    of variable name is far-fetched.%


%
%paragraphName:
For the above reason, we do not commit to either side, and use the
    suitable representation on a case-by-case basis. This flexibility
    is possible because these scope representations (\textcolor[rgb]{0,0,0.80}{\texttt{SuccScope}},
    \textcolor[rgb]{0,0,0.80}{\texttt{UnivScope}} and \textcolor[rgb]{0,0,0.80}{\texttt{ExistScope}}) are isomorphic. In the following
    we exhibit the conversion functions between \textcolor[rgb]{0,0,0.80}{\texttt{SuccScope}} one side
    and either \textcolor[rgb]{0,0,0.80}{\texttt{UnivScope}} or \textcolor[rgb]{0,0,0.80}{\texttt{ExistScope}}) on the other. We then
    prove that they form isomorphisms, assuming an idealized \textsc{Haskell}    lacking non-termination and \textcolor[rgb]{0,0,0.80}{\texttt{seq}}.%


\subsection{\textcolor[rgb]{0,0,0.80}{\texttt{UnivScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{\ensuremath{\cong}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{SuccScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}}

%
%paragraphName: conversions
The conversion functions witnessing the isomorphism are the following.%


{\nopagebreak }

%
%code:
%
%comment: succToUniv :: Functor tm ⇒
%              SuccScope tm a → UnivScope tm a
%succToUniv t = \ x → bimap id (const x) <$> t
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{succToUniv}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Functor}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{SuccScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{UnivScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{succToUniv}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{bimap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{const}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textless{}}\${}\makebox[1.22ex][c]{\textgreater{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%code:
{\noindent}%
%comment: univToSucc :: UnivScope tm a → SuccScope tm a
%univToSucc f = f ()
%
\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{univToSucc}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{UnivScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{SuccScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{univToSucc}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
The{~}\textcolor[rgb]{0,0,0.80}{\texttt{univToSucc}} function has not been given a name in the
    previous sections, but was implicitly used in the definition
    of{~}\textcolor[rgb]{0,0,0.80}{\texttt{lam}}. This is the first occurrence of the{~}\textcolor[rgb]{0,0,0.80}{\texttt{succToUniv}}    function.%


%
%paragraphName:
We prove first that{~}\textcolor[rgb]{0,0,0.80}{\texttt{UnivScope}} is a proper representation
    of{~}\textcolor[rgb]{0,0,0.80}{\texttt{SuccScope}}, that is{~}\textcolor[rgb]{0,0,0.80}{\texttt{univToSucc}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{succToUniv}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \equiv $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}. This can
    be done by simple equational reasoning{:}%


%
%comment: {- --
%


{\nopagebreak }

%
%code:
%
%comment:    univToSucc (succToUniv t)
% ≡ {- by def -}
%   univToSucc (\ x → bimap id (const x) <$> t)
% ≡ {- by def -}
%   bimap id (const ()) <$> t
% ≡ {- by () having just one element -}
%   bimap id id <$> t
% ≡ {- by (bi)functor laws -}
%   t
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{univToSucc}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{succToUniv}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \equiv $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.63,0.13,0.94}{\texttt{\makebox[1.22ex][l]{\{{}}\makebox[1.22ex][c]{-}\mbox{\hspace{0.50em}}by\mbox{\hspace{0.50em}}def\mbox{\hspace{0.50em}}\makebox[1.22ex][c]{-}\makebox[1.22ex][r]{\}{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{univToSucc}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{bimap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{const}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textless{}}\${}\makebox[1.22ex][c]{\textgreater{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \equiv $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.63,0.13,0.94}{\texttt{\makebox[1.22ex][l]{\{{}}\makebox[1.22ex][c]{-}\mbox{\hspace{0.50em}}by\mbox{\hspace{0.50em}}def\mbox{\hspace{0.50em}}\makebox[1.22ex][c]{-}\makebox[1.22ex][r]{\}{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{bimap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{const}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textless{}}\${}\makebox[1.22ex][c]{\textgreater{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \equiv $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.63,0.13,0.94}{\texttt{\makebox[1.22ex][l]{\{{}}\makebox[1.22ex][c]{-}\mbox{\hspace{0.50em}}by\mbox{\hspace{0.50em}}\makebox[1.22ex][l]{$ {(} $}\makebox[1.22ex][r]{$ {)} $}\mbox{\hspace{0.50em}}having\mbox{\hspace{0.50em}}just\mbox{\hspace{0.50em}}one\mbox{\hspace{0.50em}}element\mbox{\hspace{0.50em}}\makebox[1.22ex][c]{-}\makebox[1.22ex][r]{\}{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{bimap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textless{}}\${}\makebox[1.22ex][c]{\textgreater{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \equiv $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.63,0.13,0.94}{\texttt{\makebox[1.22ex][l]{\{{}}\makebox[1.22ex][c]{-}\mbox{\hspace{0.50em}}by\mbox{\hspace{0.50em}}\makebox[1.22ex][l]{$ {(} $}bi\makebox[1.22ex][r]{$ {)} $}functor\mbox{\hspace{0.50em}}laws\mbox{\hspace{0.50em}}\makebox[1.22ex][c]{-}\makebox[1.22ex][r]{\}{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%comment: -- -}
%


%
%paragraphName:
The second property (\textcolor[rgb]{0,0,0.80}{\texttt{succToUniv}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{univToSucc}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \equiv $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}) means that
    there is no {`}{`}junk{'}{'} in the representation{:}  one cannot
    represent more terms in{~}\textcolor[rgb]{0,0,0.80}{\texttt{UnivScope}} than in{~}\textcolor[rgb]{0,0,0.80}{\texttt{SuccScope}}.
    It is more
    difficult to prove, as it 
    and relies on parametricity and in turn on the lack of junk (non-termination or \textcolor[rgb]{0,0,0.80}{\texttt{seq}}) 
    in the host language. 
    Hence we need to use the free
    theorem for a value{~}\textcolor[rgb]{0,0,0.80}{\texttt{f}} of type{~}\textcolor[rgb]{0,0,0.80}{\texttt{UnivScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}.
    Transcoding{~}\textcolor[rgb]{0,0,0.80}{\texttt{UnivScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}} to a relation by using Paterson{'}s
    version{~}\cite{fegaras_revisiting_1996} of the abstraction
    theorem{~}\cite{reynolds-83,bernardy_proofs_2012}, assuming additionally
    that{~}\textcolor[rgb]{0,0,0.80}{\texttt{tm}} is a functor. We obtain the following lemma{:}%


%
%comment: {- --
%


{\nopagebreak }

%
%code:
%
%comment:  ∀ v₁:*.  ∀ v₂:*. ∀ v:v₁ → v₂.
% ∀ x₁:v₁. ∀ x₂:*. v x₁ ≡ x₂.
% ∀ g:(a :▹ v₁) → (a :▹ v₂).
% (∀ y:v₁. New (v y) ≡ g (New y)) →
% (∀ n:a.  Old n     ≡ g (Old n)) →
% f x₂ ≡ g <$> f x₁
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{1}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{:}*.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\ensuremath{\!}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{2}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{:}*.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{1}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{2}} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x\makebox[0.61ex][l]{$ _{{1}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{1}} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x\makebox[0.61ex][l]{$ _{{2}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{:}*.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x\makebox[0.61ex][l]{$ _{{1}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \equiv $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x\makebox[0.61ex][l]{$ _{{2}} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{g}}\textcolor[rgb]{0,0,0.80}{\texttt{{:}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{1}} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{2}} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[rgb]{0,0,0.80}{\texttt{{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{1}} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \equiv $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{g}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{n}}\textcolor[rgb]{0,0,0.80}{\texttt{{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\ensuremath{\!}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{n}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \equiv $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{g}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{n}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x\makebox[0.61ex][l]{$ _{{2}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \equiv $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{g}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textless{}}\${}\makebox[1.22ex][c]{\textgreater{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x\makebox[0.61ex][l]{$ _{{1}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%comment: -- -}
%


%
%paragraphName:
We can then specialize{~}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{1}} $}}} and{~}\textcolor[rgb]{0,0,0.80}{\texttt{x\makebox[0.61ex][l]{$ _{{1}} $}}} to{~}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}, \textcolor[rgb]{0,0,0.80}{\texttt{v}}    to{~}\textcolor[rgb]{0,0,0.80}{\texttt{const}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x\makebox[0.61ex][l]{$ _{{2}} $}}}, and{~}\textcolor[rgb]{0,0,0.80}{\texttt{g}} to{~}\textcolor[rgb]{0,0,0.80}{\texttt{bimap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}. By definition,
    \textcolor[rgb]{0,0,0.80}{\texttt{g}} satisfies the conditions of the lemma and we get{:}%


%
%comment: {- --
%


{\nopagebreak }

%
%code:
%
%comment: f x ≡ bimap id (const x) <$> f ()
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \equiv $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{bimap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{const}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textless{}}\${}\makebox[1.22ex][c]{\textgreater{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%comment: -- -}
%


%
%paragraphName:
We can then reason
    equationally{:}%


%
%comment: {- --
%


{\nopagebreak }

%
%code:
%
%comment:    f
% ≡ {- by the above -}
%   \ x → bimap id (const x) <$> f ()
% ≡ {- by def -}
%   succToUniv (f ())
% ≡ {- by def -}
%   succToUniv (univToSucc f)
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \equiv $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.63,0.13,0.94}{\texttt{\makebox[1.22ex][l]{\{{}}\makebox[1.22ex][c]{-}\mbox{\hspace{0.50em}}by\mbox{\hspace{0.50em}}the\mbox{\hspace{0.50em}}above\mbox{\hspace{0.50em}}\makebox[1.22ex][c]{-}\makebox[1.22ex][r]{\}{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{bimap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{const}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textless{}}\${}\makebox[1.22ex][c]{\textgreater{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \equiv $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.63,0.13,0.94}{\texttt{\makebox[1.22ex][l]{\{{}}\makebox[1.22ex][c]{-}\mbox{\hspace{0.50em}}by\mbox{\hspace{0.50em}}def\mbox{\hspace{0.50em}}\makebox[1.22ex][c]{-}\makebox[1.22ex][r]{\}{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{succToUniv}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \equiv $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.63,0.13,0.94}{\texttt{\makebox[1.22ex][l]{\{{}}\makebox[1.22ex][c]{-}\mbox{\hspace{0.50em}}by\mbox{\hspace{0.50em}}def\mbox{\hspace{0.50em}}\makebox[1.22ex][c]{-}\makebox[1.22ex][r]{\}{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{succToUniv}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{univToSucc}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%comment: -- -}
%


\subsection{\textcolor[rgb]{0,0,0.80}{\texttt{ExistScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{\ensuremath{\cong}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{SuccScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}} }

%
%paragraphName: conversions
The conversion functions witnessing the isomorphism are the
    following.%


{\nopagebreak }

%
%code:
%
%comment: succToExist :: SuccScope tm a → ExistScope tm a
%succToExist = E ()
%
%existToSucc :: Functor tm ⇒
%               ExistScope tm a → SuccScope tm a
%existToSucc (E _ t) = bimap id (const ()) <$> t
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{succToExist}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{SuccScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{ExistScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{succToExist}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{E}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{existToSucc}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Functor}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{ExistScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{SuccScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{existToSucc}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{E}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{bimap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{const}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textless{}}\${}\makebox[1.22ex][c]{\textgreater{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
One can recognise the functions{~}\textcolor[rgb]{0,0,0.80}{\texttt{pack}} and{~}\textcolor[rgb]{0,0,0.80}{\texttt{unpack}} as CPS
    versions of{~}\textcolor[rgb]{0,0,0.80}{\texttt{existToSucc}} and{~}\textcolor[rgb]{0,0,0.80}{\texttt{succToExist}}.%


%
%paragraphName:
The proof of{~}\textcolor[rgb]{0,0,0.80}{\texttt{existToSucc}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{succToExist}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \equiv $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}} (no junk) is nearly identical
    to the first proof about{~}\textcolor[rgb]{0,0,0.80}{\texttt{UnivScope}} and hence omitted. To
    prove \textcolor[rgb]{0,0,0.80}{\texttt{succToExist}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{existToSucc}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \equiv $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}, we first remark that by
    definition{:}%


%
%comment: {- --
%


{\nopagebreak }

%
%code:
%
%comment: succToExist (existToSucc (E y t)) ≡
%  E () (fmap (bimap id (const ())) t)
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{succToExist}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{existToSucc}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{E}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \equiv $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{E}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{bimap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{const}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%comment: -- -}
%


%
%paragraphName:
It remains to show that{~}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{E}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}} is equivalent to the right-hand
    side of the above equation. To do so, we consider any observation
    function{~}\textcolor[rgb]{0,0,0.80}{\texttt{o}} of type \textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{K}} for some constant
    type{~}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{K}}, and show that it returns the same result if applied
    to{~}\textcolor[rgb]{0,0,0.80}{\texttt{y}} and{~}\textcolor[rgb]{0,0,0.80}{\texttt{t}} or{~}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}} and{~}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{bimap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{const}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}. This fact is a consequence of the free theorem associated
    with{~}\textcolor[rgb]{0,0,0.80}{\texttt{o}}{:}%


%
%comment: {- --
%


{\nopagebreak }

%
%code:
%
%comment:  ∀ v₁:*.  ∀ v₂:*. ∀ v:v₁ → v₂.
% ∀ x₁:v₁. ∀ x₂:*. v x₁ ≡ x₂.
% ∀ t₁:tm (a :▹ v₁). ∀ t₂:tm (a :▹ v₂).
% (∀ g:(a :▹ v₁) → (a :▹ v₂).
%  (∀ y:v₁. New (v y) ≡ g (New y)) →
%  (∀ n:a.  Old n     ≡ g (Old n)) →
%  t₂ ≡ fmap g t₁) →
% o x₂ t₂ ≡ o x₁ t₁
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{1}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{:}*.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\ensuremath{\!}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{2}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{:}*.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{1}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{2}} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x\makebox[0.61ex][l]{$ _{{1}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{1}} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x\makebox[0.61ex][l]{$ _{{2}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{:}*.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x\makebox[0.61ex][l]{$ _{{1}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \equiv $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x\makebox[0.61ex][l]{$ _{{2}} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t\makebox[0.61ex][l]{$ _{{1}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{1}} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t\makebox[0.61ex][l]{$ _{{2}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{2}} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{g}}\textcolor[rgb]{0,0,0.80}{\texttt{{:}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{1}} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{2}} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[rgb]{0,0,0.80}{\texttt{{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{v\makebox[0.61ex][l]{$ _{{1}} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \equiv $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{g}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{n}}\textcolor[rgb]{0,0,0.80}{\texttt{{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{n}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \equiv $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{g}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{n}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t\makebox[0.61ex][l]{$ _{{2}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \equiv $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{g}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t\makebox[0.61ex][l]{$ _{{1}} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{o}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x\makebox[0.61ex][l]{$ _{{2}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t\makebox[0.61ex][l]{$ _{{2}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \equiv $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{o}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x\makebox[0.61ex][l]{$ _{{1}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t\makebox[0.61ex][l]{$ _{{1}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%comment: -- -}
%


%
%paragraphName:
Indeed, after specializing{~}\textcolor[rgb]{0,0,0.80}{\texttt{x\makebox[0.61ex][l]{$ _{{2}} $}}} to{~}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}} and{~}\textcolor[rgb]{0,0,0.80}{\texttt{v}}    to{~}\textcolor[rgb]{0,0,0.80}{\texttt{const}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}, the last condition amounts
    to{~}\textcolor[rgb]{0,0,0.80}{\texttt{t\makebox[0.61ex][l]{$ _{{2}} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \equiv $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{bimap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{const}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t\makebox[0.61ex][l]{$ _{{1}} $}}}, and we get the desired
    result.%


\subsection{A Matter of Style\label{styleSec}}

%
%paragraphName:
We have seen that \textcolor[rgb]{0,0,0.80}{\texttt{ExistScope}} is well-suited for term analysis, while 
  \textcolor[rgb]{0,0,0.80}{\texttt{UnivScope}} is well-suited for term construction. What about term \emph{transformations},
  which combine both aspects? In this case, one is free to choose either interface. This 
  can be illustrated by showing both alternatives for the \textcolor[rgb]{0.70,0.13,0.13}{\texttt{Lam}} case of the \textcolor[rgb]{0,0,0.80}{\texttt{fmap}} function.
  (The \textcolor[rgb]{0.70,0.13,0.13}{\texttt{App}} and \textcolor[rgb]{0.70,0.13,0.13}{\texttt{Var}} cases are identical.) Because the second version is more concise, we prefer it
    in the upcoming examples, but the other choice is equally valid.%


%
%comment: {- --
%


{\nopagebreak }

%
%code:
%
%comment: fmap' f (Lam b)
%   = unpack b $ \ x t → lamP x (fmap (bimap f id) t)
%fmap' f (Lam b)
%   = lam (\ x → fmap (bimap f id) (b `atVar` x))
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{fmap{'}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{unpack}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{lamP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{bimap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap{'}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{bimap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{`}atVar{`}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%comment: -- -}
%


%
%paragraphName:
When using \textcolor[rgb]{0,0,0.80}{\texttt{succToUniv}}, the type of the second argument of \textcolor[rgb]{0,0,0.80}{\texttt{succToUniv}}    should always be a type variable in order to have maximally polymorphic contexts.
    To remind us of this requirement when writing code, we give the alias \textcolor[rgb]{0,0,0.80}{\texttt{atVar}} for \textcolor[rgb]{0,0,0.80}{\texttt{succToUniv}}.
    (Similarly, to guarantee safety, the first argument of \textcolor[rgb]{0,0,0.80}{\texttt{pack}} (encapsulated here in \textcolor[rgb]{0,0,0.80}{\texttt{lamP}}) must be maximally polymorphic.)%


\subsection{Scope Representations and Term Representations}

%
%paragraphName:
By using an interface such as ours, term representations can be made agnostic to the
    particular scope representation one might choose. In other words, if some interface appears
    well-suited to a given application domain, one might choose it as the scope representation
    in the implementation. Typically, this choice is be guided by performance considerations.
    Within this paper we favor code concision instead, and therefore in sec.
    \ref{hereditarySec} we use \textcolor[rgb]{0,0,0.80}{\texttt{ExistScope}}, and in sections
    \ref{closureSec} and \ref{cpsSec} we use \textcolor[rgb]{0,0,0.80}{\texttt{UnivScope}}.
    %


\section{Bigger Examples\label{examples}}

\subsection{Normalization using hereditary substitution\label{hereditarySec}}

%
%paragraphName:
A standard test of binder representations is how well they support normalization. 
    In this section we show how to implement normalization using our constructions.%


%
%paragraphName:
The following type
    captures normal forms of the untyped $ \lambda $-calculus{:} a normal form is
    either an abstraction over a normal form or a neutral term (a variable applied to some normal forms). In
    this definition we use an existential-based version of scopes, which
    we splice in the{~}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LamNo}} constructor.%


{\nopagebreak }

%
%code:
%
%comment: data No a where
%  LamNo :: v → No (a :▹ v) → No a
%  Neutr :: a → [No a] → No a
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{data}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{No}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LamNo}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{No}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{No}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Neutr}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{[}}}\textcolor[rgb]{0,0,0.80}{\texttt{No}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{]}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{No}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
The key to this normalization procedure is that normal forms
    are stable under hereditary substitution{~}\cite{nanevski-08}.
    The function performing a hereditary substitution substitutes
    variables for their value, while reducing redexes on the fly.%


{\nopagebreak }

%
%code:
%
%comment: instance Monad No where
%  return x = Neutr x []
%  LamNo x t  >>= θ = LamNo x (t >>= liftSubst x θ)
%  Neutr f ts >>= θ = foldl app (θ f)((>>= θ)<$>ts)
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{instance}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Monad}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{No}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{return}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Neutr}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{[}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{]}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LamNo}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LamNo}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{liftSubst}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Neutr}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{ts}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{foldl}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{app}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textless{}}\${}\makebox[1.22ex][c]{\textgreater{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{ts}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
The most notable feature of this substitution is the use of{~}\textcolor[rgb]{0,0,0.80}{\texttt{app}}    to normalize redexes{:}%


{\nopagebreak }

%
%code:
%
%comment: app :: No a → No a → No a
%app (LamNo x t)  u = substituteOut x u t
%app (Neutr f ts) u = Neutr f (ts++[u])
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{app}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{No}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{No}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{No}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{app}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LamNo}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{u}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{substituteOut}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{u}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{app}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Neutr}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{ts}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{u}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Neutr}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{ts}}\textcolor[rgb]{0,0,0.80}{\texttt{++}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{[}}}\textcolor[rgb]{0,0,0.80}{\texttt{u}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{]}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
The normalize is then a simple recursion on the term
    structure{:}%


{\nopagebreak }

%
%code:
%
%comment: norm :: Tm a → No a
%norm (Var x)   = return x
%norm (App t u) = app (norm t) (norm u)
%norm (Lam b)   = unpack b $ \ x t →
%                   LamNo x (norm t)
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{norm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{No}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{norm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{return}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{norm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{App}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{u}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{app}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{norm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{norm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{u}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{norm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{unpack}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LamNo}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{norm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


\subsection{Closure Conversion\label{closureSec}}

%
%paragraphName:
A common phase in the compilation of functional languages is closure conversion. 
    The goal of closure conversion is make explicit the creation and opening of closures, 
    essentially implementing lexical scope. 
    What follows is a definition of closure conversion, as can be found in a textbook 
    (in fact this version is slightly adapted from \citet{guillemette_type-preserving_2007}).
    In it, we use a hat to distinguish
    object-level abstractions ($ \hat\lambda $) from host-level ones.
    Similarly, the $ @ $ sign is used for object-level applications. %


%
%paragraphName:
    The characteristic that interests us in this definition is that it is written in nominal style.
    For instance, it pretends that by matching on a $ \hat \lambda $-abstraction, one obtains a name
    $ x $ and an expression $ e $, and it is silent about the issues of freshness and
    transport of names between contexts. In the rest of the section, we construct an
    implementation which essentially retains
    these characteristics.
  %


\[ 
\begin{array}{r@{\,}l}
  \llbracket x \rrbracket &= x \\
  \llbracket \hat\lambda x. e \rrbracket &= \mathsf{closure}~(\hat\lambda x~x_\mathnormal{env}. e_\mathnormal{body})\, e_\mathnormal{env} \\
                                         &\quad \quad \mathsf{where}~\begin{array}[t]{l@{\,}l}
                                                                  y_1,\ldots,y_n & = FV(e)-\{x\} \\
                                                                  e_\mathnormal{body} & = \llbracket e \rrbracket[x_{env}.i/y_i] \\
                                                                  e_\mathnormal{env} & = \langle y_1,\ldots,y_n \rangle
                                                               \end{array}\\
  \llbracket e_1@e_2 \rrbracket &= \mathsf{let}~(x_f,x_\mathnormal{env}) = \mathsf{open}~\llbracket e_1 \rrbracket \\
                                &\quad \mathsf{in}~ x_f \langle \llbracket e_2 \rrbracket , x_\mathnormal{env} \rangle
\end{array} \]

%
%paragraphName:
The first step in implementing the above function is to define the
    target language. It features variables and applications as usual.
    Most importantly, it has a constructor for \textcolor[rgb]{0.70,0.13,0.13}{\texttt{Closure}}s, composed
    of a body and an environment. The body of closures have exactly two
    free variables{:} \textcolor[rgb]{0,0,0.80}{\texttt{vx}} for the parameter of the closure and{~}\textcolor[rgb]{0,0,0.80}{\texttt{venv}}    for its environment.
    These variables are represented
    by two \textcolor[rgb]{0,0,0.80}{\texttt{UnivScope}}s, which we splice in the type of the constructor.
    An environment is realized by a{~}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Tuple}}.
    Inside the closure, elements of the environment are accessed via
    their{~}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Index}} in the tuple. Finally, the{~}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LetOpen}} construction
    allows to access the components of a closure (its first argument)
    in an arbitrary expression (its second argument). This arbitrary
    expression has two extra free variables{:} \textcolor[rgb]{0,0,0.80}{\texttt{vf}} for the code of the
    closure and{~}\textcolor[rgb]{0,0,0.80}{\texttt{venv}} for its environment.
     %


{\nopagebreak }

%
%code:
%
%comment: data LC a where
%  VarLC :: a → LC a
%  AppLC :: LC a → LC a → LC a
%  Closure :: (∀ vx venv. vx → venv →
%           LC (Zero :▹ venv :▹ vx)) →
%           LC a → LC a
%  Tuple :: [LC a] → LC a
%  Index :: LC a → Int → LC a
%  LetOpen :: LC a → (∀ vf venv. vf → venv →
%                     LC (a :▹ vf :▹ venv)) → LC a
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{data}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{LC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{VarLC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{LC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{AppLC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{LC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{LC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{LC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Closure}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{vx}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{venv}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{vx}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{venv}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{LC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{Zero}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{venv}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{vx}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{LC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{LC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Tuple}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{[}}}\textcolor[rgb]{0,0,0.80}{\texttt{LC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{]}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{LC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Index}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{LC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Int}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{LC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LetOpen}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{LC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{vf}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{venv}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{vf}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{venv}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{LC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{vf}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{venv}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{LC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
This representation is an instance of{~}\textcolor[rgb]{0,0,0.80}{\texttt{Functor}} and{~}\textcolor[rgb]{0,0,0.80}{\texttt{Monad}}, and
    the corresponding code offers no surprise.
    We give an infix alias for{~}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{AppLC}}, named{~}\textcolor[rgb]{0,0,0.80}{\texttt{\${}\${}}}.%


%
%paragraphName:
Closure conversion can then be implemented as a function
    from{~}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}} to{~}\textcolor[rgb]{0,0,0.80}{\texttt{LC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}. The case of variables is trivial. For
    an abstraction, one must construct a closure, whose environment
    contains each of the free variables in the body. The application
    must open the closure, explicitly applying the argument and the
    environment.%


%
%paragraphName:
The implementation closely follows the mathematical definition given
    above. The work to manage variables explicitly is limited to the
    lifting of the substitution $ [x_{env}.i/y_i] $, and an application of
    \textcolor[rgb]{0,0,0.80}{\texttt{wk}}. Additionally, the substitution performed \textcolor[rgb]{0,0,0.80}{\texttt{wk}} is 
    inferred automatically by GHC.%


{\nopagebreak }

%
%code:
%
%comment: cc :: Eq a ⇒ Tm a → LC a
%cc (Var x) = VarLC x
%cc t0@(Lam b) =
%  let yn = nub $ freeVars t0
%  in Closure (\ x env → cc (b `atVar` x) >>=
%                   liftSubst x (idxFrom yn env))
%             (Tuple $ map VarLC yn)
%cc (App e1 e2) =
%  LetOpen (cc e1)
%          (\ f x → var f $$ wk (cc e2) $$ var x)
%
%idxFrom :: Eq a ⇒ [a] → v → a → LC (Zero :▹ v)
%idxFrom yn env z = Index (var env) $
%                   fromJust (elemIndex z yn)
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{cc}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Eq}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{LC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{cc}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{VarLC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{cc}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t0}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{@}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{let}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{yn}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{nub}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{freeVars}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t0}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{in}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Closure}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{env}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{cc}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{`}atVar{`}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{liftSubst}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{idxFrom}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{yn}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{env}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Tuple}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{map}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{VarLC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{yn}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{cc}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{App}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{e1}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{e2}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LetOpen}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{cc}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{e1}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{wk}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{cc}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{e2}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{idxFrom}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Eq}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{[}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{]}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{LC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{Zero}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{idxFrom}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{yn}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{env}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{z}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Index}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{env}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fromJust}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{elemIndex}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{z}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{yn}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
A notable difference between the above implementation and that of
    \citeauthor{guillemette_type-preserving_2007} is the following.
    They first modify the
    function to take an additional substitution argument, citing the
    difficulty to support a direct implementation with de{~}Bruijn
    indices. We need not do any such modification{:} our interface is
    natural enough to support a direct implementation of the algorithm.%


\subsection{CPS Transform\label{cpsSec}}

%
%paragraphName: intro
The next example is a transformation to continuation-passing
    style (CPS) based partially on work by \citet{chlipala_parametric_2008} and
    \citet{guillemette_type-preserving_2008}.
    The main objective of the transformation is to make the
    order of evaluation explicit, by $ \mathsf{let} $-binding every intermediate{~}\textcolor[rgb]{0,0,0.80}{\texttt{Value}} in
    a specific order. To this end, we target a special representation,
    where every intermediate result is named. We allow for{~}\textcolor[rgb]{0,0,0.80}{\texttt{Value}}s to be
    pairs, so we can easily replace each argument with a pair of an
    argument and a continuation.%


{\nopagebreak }

%
%code:
%
%comment: data TmC a where
%  HaltC :: Value a → TmC a
%  AppC  :: Value a → Value a → TmC a
%  LetC  :: Value a → TmC (Succ a) → TmC a
%
%data Value a where
%  LamC  :: TmC (Succ a) → Value a
%  PairC :: Value a → Value a → Value a
%  VarC  :: a → Value a
%  FstC  :: a → Value a
%  SndC  :: a → Value a
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{data}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{HaltC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Value}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{AppC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Value}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Value}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LetC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Value}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{Succ}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{data}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Value}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LamC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{Succ}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Value}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{PairC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Value}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Value}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Value}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{VarC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Value}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{FstC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Value}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{SndC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Value}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: smart constructors
We do not use \textcolor[rgb]{0,0,0.80}{\texttt{Value}}s directly, but instead their composition with injection.%


{\nopagebreak }

%
%code:
%
%comment: varC :: (v :∈ a) ⇒ v → Value a
%letC :: Value a → UnivScope TmC a → TmC a
%lamC :: UnivScope TmC a → Value a
%fstC :: (v :∈ a) ⇒ v → Value a
%sndC :: (v :∈ a) ⇒ v → Value a
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{varC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \in $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Value}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{letC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Value}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{UnivScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{lamC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{UnivScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Value}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{fstC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \in $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Value}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{sndC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \in $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Value}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: Functor TmC
Free variables in{~}\textcolor[rgb]{0,0,0.80}{\texttt{TmC}} can be renamed, thus it enjoys a functor
    structure, with a straightforward implementation found in appendix.
    However, this new syntax{~}\textcolor[rgb]{0,0,0.80}{\texttt{TmC}} is not stable under substitution.
    Building a monadic structure would be more involved, and is directly
    tied to the transformation we perform and the operational semantics
    of the language, so we omit it.%


%
%paragraphName: the transformation
We implement a one-pass CPS transform (administrative redexes are
    not created). This is done by passing a host-language continuation
    to the transformation. At the top-level the halting continuation
    is used. A definition of the transformation using mathematical
    notation could be written as follows.%


\[ 
\begin{array}{r@{\,}l}
 \llbracket x \rrbracket\,\kappa &= \kappa\,x \\
 \llbracket e_1 \,@\, e_2 \rrbracket\,\kappa &= \llbracket e_1 \rrbracket (\lambda f. \\
                                       &\quad \llbracket e_2 \rrbracket (\lambda x. \\
                                       &\quad f \, @ \, \langle x, \kappa \rangle ) ) \\
 \llbracket \hat\lambda x. e \rrbracket \kappa &= \mathsf{let}\, f = \hat\lambda p. \begin{array}[t]{l}
                                       \mathsf{let}\, x_1 = \mathsf{fst}\, p \,\mathsf{in}\\
                                       \mathsf{let}\, x_2  = \mathsf{snd}\, p \,\mathsf{in} \\
                                       \llbracket e[x_1/x] \rrbracket (\lambda r.\, x_2 \, @ \, r) \end{array}  \\
                                      &\quad \mathsf{in} \, \kappa\,f
\end{array} \]

%
%paragraphName: latex vs. haskell
The implementation follows the above definition, except for the
    following minor differences. For the{~}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Lam}} case, the only
    deviation is an occurrence of{~}\textcolor[rgb]{0,0,0.80}{\texttt{wk}}. In the{~}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{App}} case, we
    have an additional reification of the host-level continuation as a
    proper \textcolor[rgb]{0,0,0.80}{\texttt{Value}} using the{~}\textcolor[rgb]{0,0,0.80}{\texttt{lamC}} function.
    In the variable case, we must pass the variable{~}\textcolor[rgb]{0,0,0.80}{\texttt{v}} to the
    continuation. Doing so yields a value of type{~}\textcolor[rgb]{0,0,0.80}{\texttt{TmC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}.
    To obtain a result of the right type it suffices to remove the
    extra tagging introduced by{~}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}} everywhere in the term,
    using{~}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{untag}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textless{}}\${}\makebox[1.22ex][c]{\textgreater{}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}. Besides, we use a number of instances of \textcolor[rgb]{0,0,0.80}{\texttt{wk}}, 
    and for each of them
    GHC is able to infer the substitution to perform.%


{\nopagebreak }

%
%code:
%
%comment: cps0 :: Tm a → TmC a
%cps0 t = cps t $ HaltC . varC
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{cps0}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{cps0}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{cps}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{HaltC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{varC}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%code:
{\noindent}%
%comment: cps :: Tm a → (∀ v. v → TmC (a :▹ v)) → TmC a
%cps (Var x)     k = untag <$> k x
%cps (App e1 e2) k =
%  cps e1 $ \ x1 →
%  cps (wk e2) $ \ x2 →
%  AppC (varC x1)
%       (PairC (varC x2)
%              (lamC (\ x → wk $ k x)))
%cps (Lam e)    k =
%  letC
%    (lamC $ \p →
%       letC (fstC p) $ \ x1 →
%       letC (sndC p) $ \ x2 →
%       cps (wk $ e `atVar` x1) $ \r →
%       AppC (varC x2) (varC r)) k
%
\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{cps}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{cps}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{k}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{untag}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textless{}}\${}\makebox[1.22ex][c]{\textgreater{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{k}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{cps}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{App}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{e1}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{e2}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{k}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{cps}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{e1}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x1}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{cps}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{wk}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{e2}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x2}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{AppC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{varC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x1}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{PairC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{varC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x2}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{lamC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{wk}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{k}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{cps}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{e}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{k}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{letC}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{lamC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{p}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{letC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{fstC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{p}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x1}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{letC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{sndC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{p}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x2}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{cps}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{wk}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{e}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{`}atVar{`}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x1}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{r}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{AppC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{varC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x2}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{varC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{r}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{k}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
It is folklore that a CPS transformation is easier
    to implement with higher-order abstract syntax
    \cite{guillemette_type-preserving_2008,washburn_boxes_2003}. Our
    interface for name abstractions features a form of higher-order
    representation. (Namely, a quantification, over a universally
    quantified type.) However limited, this higher-order aspect is
    enough to allow an easy implementation of the CPS transform.%


\section{Related Work\label{comparison}}

%
%paragraphName:
Representing names and binders in a safe and convenient manner is
   a long-standing issue, with an extensive body of work devoted to it.
   A survey is far beyond the scope of this paper.
   Hence, we limit our comparison the work that we judge most relevant, 
   or whose contrasts with our proposal is the most revealing.
  %


%
%paragraphName:
However, we do not limit our comparison to interfaces for names and
    binders, but also look at terms representations. Indeed, we have 
    noted in sec. \ref{styleSec} that every term representation embodies
    an interface for binders.%


\subsection{\textcolor[rgb]{0,0,0.80}{\texttt{Fin}}}

%
%paragraphName: Fin approach description
Another approach already used and described by{~}\citet{altenkirch-93,mcbride-mckinna-04} is
    to index terms, names, etc. by a number, a bound. This bound is the
    maximum number of distinct free variables allowed in the value. This
    rule is enforced in two parts{:} variables have to be strictly lower
    than their bound, and the bound is incremented by one when crossing
    a name abstraction (a $ \lambda $-abstraction for instance).%


%
%paragraphName: Fin type description
The type{~}\textcolor[rgb]{0,0,0.80}{\texttt{Fin}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{n}} is used for variables and represents natural
    numbers strictly lower than{~}\textcolor[rgb]{0,0,0.80}{\texttt{n}}. The name \textcolor[rgb]{0,0,0.80}{\texttt{Fin}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{n}} comes from the
    fact that it defines finite sets of size{~}\textcolor[rgb]{0,0,0.80}{\texttt{n}}.%


%
%paragraphName: Fin/Maybe connection
We can draw a link with Nested Abstract Syntax. Indeed,
    as with the type{~}\textcolor[rgb]{0,0,0.80}{\texttt{Succ}} (\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}} or \textcolor[rgb]{0,0,0.80}{\texttt{Maybe}}), the
    type \textcolor[rgb]{0,0,0.80}{\texttt{Fin}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{suc}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{n}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}} has exactly one more element than the
    type{~}\textcolor[rgb]{0,0,0.80}{\texttt{Fin}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{n}}. However, these approaches are not equivalent for
    at least two reasons. Nested Abstract Syntax can accept any
    type to represent variables. This makes the structure more like a
    container and this allows to exhibit the substitutive 
    structure of terms as monads. The{~}\textcolor[rgb]{0,0,0.80}{\texttt{Fin}} approach has advantages as well{:} the
    representation is concrete and closer to the original
    approach of de{~}Brujin. In particular the representation of
    free and bound variables is more regular, and it may be more amenable
    to the optimization of variables as machine integers.%


\subsection{Higher-Order Abstract Syntax (HOAS)}

%
%paragraphName:
A way to represent bindings of an object language is via the
    bindings of the host language. One naive translation of this idea
    yields the following term representation{:}%


{\nopagebreak }

%
%code:
%
%comment: data TmH = LamH (TmH → TmH) | AppH TmH TmH
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{data}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmH}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LamH}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmH}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmH}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{\textbar{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{AppH}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmH}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmH}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
An issue with this kind of representation is the presence of
    so-called {``}exotic terms{''}{:} a function of type \textcolor[rgb]{0,0,0.80}{\texttt{TmH}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmH}} which
    performs pattern matching on its argument does not necessarily
    represent a term of the object language. A proper realization of the
    HOAS idea should only allow functions which use their argument for
    substitution.%


%
%paragraphName:
It has been observed before that one can implement this restriction
    by using polymorphism. This observation also underlies the safety of
    our{~}\textcolor[rgb]{0,0,0.80}{\texttt{UnivScope}} representation.%


%
%paragraphName:
Another disadvantage of HOAS is the negative occurrence
    of the recursive type, which makes it tricky to analyze
    terms{~}\cite{washburn_boxes_2003}.%


\subsection{Syntax for free}

%
%paragraphName:
\citet{atkey-hoas-09} revisited the polymorphic encoding
    of the HOAS representation of the untyped lambda calculus. By
    constructing a model of System F{'}s parametricity in \textsc{Coq} he could
    formally prove that polymorphism rules out the exotic terms.
    Name abstractions, while represented by computational functions,
    cannot react to the shape of their argument and thus
    behave as substitutions. Here is this representation in \textsc{Haskell}{:}%


{\nopagebreak }

%
%code:
%
%comment: type TmF = ∀ a. ((a → a) → a)  -- lam
%              → (a → a → a)   -- app
%              → a
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{type}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmF}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.63,0.13,0.94}{\texttt{\makebox[1.22ex][c]{-}\makebox[1.22ex][c]{-}\mbox{\hspace{0.50em}}lam}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.63,0.13,0.94}{\texttt{\makebox[1.22ex][c]{-}\makebox[1.22ex][c]{-}\mbox{\hspace{0.50em}}app}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
And our familiar application function{:}%


{\nopagebreak }

%
%code:
%
%comment: apTmF :: TmF
%apTmF lam app = lam $ \ f → lam $ \ x → f `app` x
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{apTmF}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmF}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{apTmF}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{app}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{`}app{`}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName: catamorphism only & can't go back
Being a polymorphic encoding, this technique is limited to analyze terms
    via folds (catamorphism). Indeed,
    there is no known safe way to convert a term of this polymorphic
    encoding to another safe representation of names. As Atkey
    shows, this conversion relies on the Kripke version of the
    parametricity result of this type. (At the moment, the attempts to
    integrate parametricity in a programming language only support 
    non-Kripke versions \cite{keller_parametricity_2012,bernardy_computational_2012,bernardy_type-theory_2013}.)%


\subsection{Parametric Higher-Order Abstract Syntax (PHOAS)}

%
%paragraphName:
\citet{chlipala_parametric_2008} describes a way to represent binders
    using polymorphism and functions. Using that technique, called
    Parametric Higher-Order Abstract Syntax (PHOAS), terms of the
    untyped $ \lambda $-calculus are as represented follows{:}%


{\nopagebreak }

%
%code:
%
%comment: data TmP a where
%  VarP :: a → TmP a
%  LamP :: (a → TmP a) → TmP a
%  AppP :: TmP a → TmP a → TmP a
%
%type TmP' = ∀ a. TmP a
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{data}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{VarP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LamP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{AppP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{type}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmP{'}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
Only universally quantified terms{~}(\textcolor[rgb]{0,0,0.80}{\texttt{TmP{'}}}) are
    guaranteed to correspond to terms of the $ \lambda $-calculus.%


%
%paragraphName:
The representation of binders used by Chlipala can be seen as a
    special version of \textcolor[rgb]{0,0,0.80}{\texttt{UnivScope}}, where all variables are assigned
    the same type. This specialization has pros and cons. On the plus
    side, substitution is easier to implement with PHOAS{:} fresh variables 
    do not need special treatment. The corresponding implementation
    of the monadic \textcolor[rgb]{0,0,0.80}{\texttt{join}} is as follows{:}%


{\nopagebreak }

%
%code:
%
%comment: joinP (VarP x)   = x
%joinP (LamP f)   = LamP (\ x → joinP (f (VarP x)))
%joinP (AppP t u) = AppP (joinP t) (joinP u)
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{joinP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{VarP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{joinP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LamP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LamP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{joinP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{VarP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{joinP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{AppP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{u}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{AppP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{joinP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{joinP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{u}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
On the minus side, all the variables (bound and free) have the
    same representation. This means that they cannot be told apart
    within a term of type{~}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}. Additionally, once the type
    variable{~}\textcolor[rgb]{0,0,0.80}{\texttt{a}} is instantiated to a closed type, one cannot recover
    the polymorphic version. Furthermore while{~}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Zero}} denotes a
    closed term, \textcolor[rgb]{0,0,0.80}{\texttt{TmP}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Zero}} denotes a term \emph{without} variables, hence no
    term at all. Therefore, whenever a user of PHOAS needs to perform
    some manipulation on terms, they must make an upfront choice of a
    particular instance for the parameter of{~}\textcolor[rgb]{0,0,0.80}{\texttt{TmP}} that supports
    all the required operations on free variables. This limitation is
    not good for modularity, and for code clarity in general. Another issue
    arises from the negative occurrence of the variable type. Indeed this
    makes the type{~}\textcolor[rgb]{0,0,0.80}{\texttt{TmP}} invariant{:} it cannot be made a{~}\textcolor[rgb]{0,0,0.80}{\texttt{Functor}}    nor a{~}\textcolor[rgb]{0,0,0.80}{\texttt{Traversable}} and this not a proper{~}\textcolor[rgb]{0,0,0.80}{\texttt{Monad}} either.%


%
%paragraphName:
The use-case of PHOAS presented by Chlipala is the representation
    of well-typed terms. That is, the parameter to{~}\textcolor[rgb]{0,0,0.80}{\texttt{TmP}} can be made
    a type-function, to capture the type associated with each variable.
    This is not our concern here, but we have no reason to believe that
    our technique cannot support this, beyond the lack of proper for
    type-level computation in \textsc{Haskell} --- Chlipala uses \textsc{Coq} for his
    development.%


\subsection{McBride{'}s {``}Classy Hack{''}}

%
%paragraphName:
\citet{mcbride_not_2010} has devised a set of combinators to construct
        $ \lambda $-terms in de{~}Brujin representation, with the ability to refer to
        bound variables by name. Terms constructed using McBride{'}s technique are
        textually identical to terms constructed using ours. Another point of
        similarity is the use of instance search to recover the indices from a
        host-language variable name.
        A difference is that McBride integrates the injection in the abstraction
        constructor rather than the variable constructor. The type of the \textcolor[rgb]{0,0,0.80}{\texttt{var}} combinator then becomes
        simpler, at the expense of \textcolor[rgb]{0,0,0.80}{\texttt{lam}}{:}
        %


%
%comment: {- --
%


{\nopagebreak }

%
%code:
%
%comment: lam :: ((∀ n. (Leq (S m) n ⇒ Fin n)) → Tm (S m))
%       → Tm m
%var :: Fin n → Tm n
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{n}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{Leq}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{S}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{m}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{n}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Fin}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{n}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{S}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{m}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{m}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Fin}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{n}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{n}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%comment: -- -}
%


%
%paragraphName:
An advantage of McBride{'}s interface is that it does not require the
    {``}incoherent instances{''} extension. %


%
%paragraphName:
However, because McBride represents variables as{~}\textcolor[rgb]{0,0,0.80}{\texttt{Fin}}, the types
    of his combinators are less precise ours. Notably, the{~}\textcolor[rgb]{0,0,0.80}{\texttt{Leq}}    class captures only one aspect of context inclusion (captured
    by the class{~}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.83ex][c]{$ \subseteq $}}} in our development), namely that one context
    should be smaller than another. This means, for example, that the
    class constraint{~}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.83ex][c]{$ \subseteq $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}} can be meaningfully resolved in more
    cases than{~}\textcolor[rgb]{0,0,0.80}{\texttt{Leq}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{m}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{n}}, in turn making functions such as{~}\textcolor[rgb]{0,0,0.80}{\texttt{wk}}    more useful in practice. Additionally, our{~}\textcolor[rgb]{0,0,0.80}{\texttt{unpack}} and{~}\textcolor[rgb]{0,0,0.80}{\texttt{pack}}    combinators extend the technique to term analysis and manipulation.%


\subsection{\textsc{NomPa} (nominal fragment)}

%
%paragraphName:
\citet{pouillard_unified_2012} describe an interface for names and
    binders which provides maximum safety. The library{~}\textsc{NomPa} is
    written in \textsc{Agda}, using dependent types. The interface makes use
    of a notion of{~}\textcolor[rgb]{0,0,0.80}{\texttt{World}}s (intuitively a set of names),{~}\textcolor[rgb]{0,0,0.80}{\texttt{Binder}}s
    (name declaration), and{~}\textcolor[rgb]{0,0,0.80}{\texttt{Name}}s (the occurrence of a name).
    A{~}\textcolor[rgb]{0,0,0.80}{\texttt{World}}   can   either   be{~}\textcolor[rgb]{0,0,0.80}{\texttt{Empty}}   (called{~}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \emptyset $}}}   in   the
    library{~}\textsc{NomPa}) in or  result of the addition  of a{~}\textcolor[rgb]{0,0,0.80}{\texttt{Binder}} to
    an existing{~}\textcolor[rgb]{0,0,0.80}{\texttt{World}}, using the operator \textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\ensuremath{\triangleleft}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}. The type{~}\textcolor[rgb]{0,0,0.80}{\texttt{Name}}    is indexed by{~}\textcolor[rgb]{0,0,0.80}{\texttt{World}}s{:} this ties occurrences to the context where
    they make sense.%


%
%comment: {- --
%


{\nopagebreak }

%
%code:
%
%comment: World :: *
%Binder :: *
%Empty :: World
%(◅) :: Binder → World → World
%Name :: World → *
%
~\\~\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{World}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{*}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{Binder}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{*}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{Empty}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{World}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\ensuremath{\triangleleft}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Binder}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{World}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{World}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{Name}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{World}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{*}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%comment: -- -}
%


%
%paragraphName:
  On top of these abstract notions, one can construct the following representation of terms (we use
  a \textsc{Haskell}-style syntax for dependent types, similar to that of \textsc{Idris}){:}
  %


%
%comment: {- --
%


{\nopagebreak }

%
%code:
%
%comment: data Tm α where
%  Var :: Name α → Tm α
%  App :: Tm α → Tm α → Tm α
%  Lam :: (b :: Binder) → Tm (b ◅ α) → Tm α
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{data}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \alpha $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Var}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Name}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \alpha $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \alpha $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{App}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \alpha $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \alpha $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \alpha $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Lam}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Binder}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\ensuremath{\triangleleft}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \alpha $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \alpha $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%comment: -- -}
%


%
%paragraphName:
The safety of the technique comes from the abstract character of the
    interface. If one were to give concrete definitions for \textcolor[rgb]{0,0,0.80}{\texttt{Binder}},
    \textcolor[rgb]{0,0,0.80}{\texttt{World}} and their related operations, it would become possible for user
    code to cheat the system.
    A drawback of the interface being abstract is that some subterms
    do not evaluate. This point is of prime concern in the context of
    reasoning about programs involving binders.
    In contrast, our interfaces are concrete (code using it
    always evaluates), but it requires the user to choose the
    representation appropriate to the current use (\textcolor[rgb]{0,0,0.80}{\texttt{SuccScope}},
    \textcolor[rgb]{0,0,0.80}{\texttt{UnivScope}} or \textcolor[rgb]{0,0,0.80}{\texttt{ExistScope}}).%


\section{Discussion\label{discussion}}

\subsection{Binding Many Variables}

%
%paragraphName:
    In \textcolor[rgb]{0,0,0.80}{\texttt{SuccScope}}, there is exactly one more free variable available in the sub-term.
    However, it might be useful to bind multiple names at once in a binder. This can 
    be done by using a type \textcolor[rgb]{0,0,0.80}{\texttt{n}} of the appropriate cardinality instead of \textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}.
    This technique has been used for example by \citet{bound-kmett-12}.%


{\nopagebreak }

%
%code:
%
%comment: type NScope n tm a = tm (a :▹ n)
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{type}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{NScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{n}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{n}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
Adapting the idea to our framework would mean to quantify over a family of types,
    indexed by a type \textcolor[rgb]{0,0,0.80}{\texttt{n}} of the appropriate cardinality{:}%


%
%comment: {- --
%


{\nopagebreak }

%
%code:
%
%comment: type NUnivScope  n tm a = ∀v. (n → v) → tm (a :▹ v)
%type NExistScope n tm a = ∃v. (n → v) ×   tm (a :▹ v)
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{type}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{NUnivScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{n}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{n}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{type}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{NExistScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{n}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \exists $}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{n}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \times $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%comment: -- -}
%


\subsection{Delayed Substitutions}

%
%paragraphName:
The main performance issue with de{~}Brujn indices comes from the cost of importing
    terms into scopes without capture, which requires to increment
    free-variables in the substituted term (see \textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}} in the definition of \textcolor[rgb]{0,0,0.80}{\texttt{liftSubst}}). 
    This transformation incurs not only a direct cost proportional to the size of terms,
    but also an indirect cost in the form of loss of sharing.%


%
%paragraphName:
\Citet{bird-paterson-99} propose a solution to this issue, which can be expressed
     simply as another implementation of binders, where free variables of the inner term stand for 
     whole terms with one less free variables{:}%


{\nopagebreak }

%
%code:
%
%comment: type DelayedScope tm a = tm (tm a :▹ ())
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{type}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{DelayedScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
This means that the parallel substitution for a term representation 
    based on \textcolor[rgb]{0,0,0.80}{\texttt{DelayedScope}} does not require lifting of substitutions.%


{\nopagebreak }

%
%code:
%
%comment: data TmD a where
%  VarD :: a → TmD a
%  LamD :: DelayedScope TmD a  → TmD a
%  AppD :: TmD a → TmD a → TmD a
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{data}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmD}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{VarD}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmD}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LamD}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{DelayedScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmD}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmD}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{AppD}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmD}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmD}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmD}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


{\nopagebreak }

%
%code:
%
%comment: instance Monad TmD where
%  return = VarD
%  VarD a >>= θ = θ a
%  AppD a b >>= θ = AppD (a >>= θ) (b >>= θ)
%  LamD t >>= θ = LamD (t >>= \ x → VarD $ case x of
%                   New b → New b
%                   Old a → Old (a >>= θ))
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{instance}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Monad}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmD}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{return}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{VarD}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{VarD}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{AppD}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{AppD}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LamD}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LamD}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{VarD}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\${}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{case}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{of}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%paragraphName:
Because idea of delayed substitutions is concerned with free variables, and
    the concepts we present here is concerned with bound variables, one can
    one can easily define scopes which are both delayed and safe. Hence
    the performance gain can is compatible with our safe interface.%


%
%comment: {- --
%


{\nopagebreak }

%
%code:
%
%comment: type UnivScope'  tm a = ∀v. (v → tm (tm a :▹ v))
%type ExistScope' tm a = ∃v. (v ,  tm (tm a :▹ v))
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{type}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{UnivScope{'}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{type}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{ExistScope{'}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \exists $}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{,}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%comment: -- -}
%


\subsection{Future Work{:} Improving Safety}

%
%paragraphName:
As it stands our interface prevents mistakes in the manipulation of de{~}Bruijn indices, but
    requires a collaboration from the user. 
    Indeed, a malicious user can instantiate \textcolor[rgb]{0,0,0.80}{\texttt{v}} 
    to a monotype either in the analysis of
    \textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][c]{$ \forall $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}} or in the construction of \textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \exists $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{v,}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}. This situation can be improved 
    by providing a quantifier which allows to substitute for type variables only other type variables.
    This
    quantifier can be understood as being at the same time existential and universal, 
    and hence is self dual.
    We the notation \textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\ensuremath{\nabla}}} (pronounced nabla) for it, due to the similarity with the quantifier
    of the same name introduced by \citet{miller_proof_2003}.
    We would then have the following definitions, and safety could not be compromised. %


%
%comment: {- --
%


{\nopagebreak }

%
%code:
%
%comment: type UnivScope  tm a = ∇ v.  v → tm (a :▹ v)
%type ExistScope tm a = ∇ v. (v ,  tm (a :▹ v))
%
~\\~\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{type}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{UnivScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\ensuremath{\nabla}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{type}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{ExistScope}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\ensuremath{\nabla}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{,}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%comment: -- -}
%


%
%paragraphName:
   These definitions would preclude using \textcolor[rgb]{0,0,0.80}{\texttt{SuccScope}} as an implementation, 
   however this should not cause any issue{:} either of the above could be used directly
   as an implementation.
   Supporting our version of \textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\ensuremath{\nabla}}} in a type-checker seems a rather modest extension,
   therefore we wish to investigate how some future version of GHC could support it.
   %


\subsection{Future Work{:} Improve Performance}

%
%paragraphName:
An apparent issue with our conversion functions between
    \textcolor[rgb]{0,0,0.80}{\texttt{ExistScope}} or \textcolor[rgb]{0,0,0.80}{\texttt{UnivScope}} on one side and \textcolor[rgb]{0,0,0.80}{\texttt{SuccScope}} on the
    other side is that all but \textcolor[rgb]{0,0,0.80}{\texttt{succToExist}} cost a time 
    proportional to the size of the term converted. In the current state of affairs, we 
    might be able to use a system of rewrite rules, such as that implemented in GHC, to 
    eliminate the conversions to and from the safe interfaces. However, within
    a system which supports \ensuremath{\nabla}-quantification, a better option offers itself{:}
    the machine-representation of the type \textcolor[rgb]{0,0,0.80}{\texttt{v}} should be
    nil (nothing at all) if \textcolor[rgb]{0,0,0.80}{\texttt{v}} is a \ensuremath{\nabla}-bound variable; 
    therefore the machine-implementation of the conversions
    can be the identity.%


\subsection{Future Work{:} No Injections}

%
%paragraphName: getting rid of the injections by using a stronger type system
    We use the instance search of GHC in a very specific way{:} only to discover in injections.
    This suggests that a special-purpose type-system (featuring a form of subtyping)
    could be built to take care of those injections automatically.
    An obvious benefit would be some additional shortening of programs manipulating terms.
    Additionally, this simplification of programs would imply an
    even greater simplification of the proofs about them; indeed, a variation in complexity in
    an object usually yields a greater variation in complexity in proofs about it.
  %


\subsection{Conclusion}

%
%paragraphName:
  We have shown how to make de{~}Bruijn indices safe, by typing them precisely with 
  the context where they make sense. Such precise contexts are obtained is by using (appropriately)
  either of the interfaces \textcolor[rgb]{0,0,0.80}{\texttt{UnivScope}} or \textcolor[rgb]{0,0,0.80}{\texttt{ExistScope}}. These two interfaces can 
  be seen as the both sides of the \ensuremath{\nabla} quantifier of \citet{miller_proof_2003}. 
  Essentially, we have deconstructed that flavor of quantification over names, 
  and implemented it in \textsc{Haskell}. The result is a safe method to manipulate names
  and binders, which is supported by today{'}s Glasgow Haskell Compiler.%


%
%paragraphName:
  The method preserves the good properties of de{~}Bruijn indices, while providing
  a convenient interface to program with multiple open binders. We have illustrated 
  these properties by exhibiting the implementation of a number of examples.
  %


\acks{}We thank Emil Axelsson, Koen Claessen, Daniel Gustafsson and Patrik Jansson for
    useful feedback.

\bibliographystyle{abbrvnat}

\bibliography{../../local,../../npouillard,../../jp}

\newpage

\appendix

\section{Implementation details\label{implementationExtras}}

\subsection{Traversable}

%
%code:
{\noindent}%
%comment: instance Foldable Tm where
%  foldMap = foldMapDefault
%
\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{instance}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Foldable}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{foldMap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{foldMapDefault}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


\subsection{NbE}

%
%code:
{\noindent}%
%comment: instance Functor No where
%  fmap f (LamNo x t)  =
%     LamNo x (fmap (bimap f id) t)
%  fmap f (Neutr x ts) =
%     Neutr (f x) (fmap (fmap f) ts)
%
\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{instance}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Functor}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{No}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LamNo}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LamNo}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{bimap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Neutr}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{ts}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Neutr}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{ts}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


\subsection{CPS}

%
%code:
{\noindent}%
%comment: instance Functor Value where
%  fmap f (VarC x)      = VarC (f x)
%  fmap f (FstC x)      = FstC (f x)
%  fmap f (SndC x)      = SndC (f x)
%  fmap f (PairC v1 v2) =
%     PairC (fmap f v1) (fmap f v2)
%  fmap f (LamC t)      =
%     LamC (fmap (bimap f id) t)
%
%instance Functor TmC where
%  fmap f (HaltC v)    = HaltC (fmap f v)
%  fmap f (AppC v1 v2) =
%     AppC  (fmap f v1) (fmap f v2)
%  fmap f (LetC p t)   =
%     LetC (fmap f p) (fmap (bimap f id) t)
%
\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{instance}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Functor}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Value}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{VarC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{VarC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{FstC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{FstC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{SndC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{SndC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{PairC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v1}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v2}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{PairC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v1}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v2}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LamC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LamC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{bimap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{instance}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Functor}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{TmC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{HaltC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{HaltC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{AppC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v1}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v2}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{AppC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v1}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v2}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LetC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{p}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LetC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{p}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{bimap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%code:
{\noindent}%
%comment: letC p f = LetC p (f ())
%varC = VarC . inj
%lamC f = LamC (f ())
%fstC = FstC . inj
%sndC = SndC . inj
%
\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{letC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{p}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LetC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{p}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{varC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{VarC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{inj}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{lamC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LamC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{fstC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{FstC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{inj}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{sndC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{SndC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{inj}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


\subsection{Closure Conversion}

%
%code:
{\noindent}%
%comment: instance Functor LC where
%  fmap f t = t >>= return . f
%
%instance Monad LC where
%  return = VarLC
%  VarLC x >>= θ = θ x
%  Closure c env >>= θ = Closure c (env >>= θ)
%  LetOpen t g >>= θ = LetOpen (t >>= θ)
%    (\ f env → g f env >>=
%        liftSubst env (liftSubst f θ))
%  Tuple ts >>= θ = Tuple (map (>>= θ) ts)
%  Index t i >>= θ = Index (t >>= θ) i
%  AppLC t u >>= θ = AppLC (t >>= θ) (u >>= θ)
%
\vphantom{$\{$}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{instance}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Functor}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{LC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{return}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{.}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{instance}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Monad}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{LC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{return}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{VarLC}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{VarLC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Closure}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{c}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{env}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Closure}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{c}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{env}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LetOpen}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{g}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{LetOpen}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \lambda $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{env}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{g}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{env}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{liftSubst}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{env}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{liftSubst}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Tuple}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{ts}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Tuple}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{map}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{ts}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Index}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{i}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Index}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{i}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{AppLC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{u}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{AppLC}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{u}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\textgreater{}}\makebox[1.22ex][c]{\textgreater{}}{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \theta $}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


\section{Bind and substitute an arbitrary name}

%
%code:
{\noindent}%
%comment: packGen _ t x = fmap (shuffle cx) t
%  where cx :: v → w
%        cx _ = x
%
%class (v :∈ b) ⇒ Insert v a b where
%  -- inserting 'v' in 'a' yields 'b'.
%  shuffle :: (v → w) → b → a :▹ w
%
%instance Insert v a (a :▹ v) where
%  shuffle f (New x) = New (f x)
%  shuffle f (Old x) = Old x
%
%instance Insert v a b ⇒
%         Insert v (a :▹ v') (b :▹ v') where
%  shuffle f (New x) = Old (New x)
%  shuffle f (Old x) = case shuffle f x of
%    New y → New y
%    Old y → Old (Old y)
%
%substituteGen ::
%   (Insert v a b, Functor tm, Monad tm) ⇒
%   v → tm a → tm b → tm a
%substituteGen x t u =
%   substituteOut x t (fmap (shuffle id) u)
%
\vphantom{$\{$}\textcolor[rgb]{0,0,0.80}{\texttt{packGen}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{shuffle}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{cx}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{cx}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{w}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{cx}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{\_{}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{class}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\makebox[1.22ex][c]{$ \in $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Insert}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.63,0.13,0.94}{\texttt{\makebox[1.22ex][c]{-}\makebox[1.22ex][c]{-}\mbox{\hspace{0.50em}}inserting\mbox{\hspace{0.50em}}{'}v{'}\mbox{\hspace{0.50em}}in\mbox{\hspace{0.50em}}{'}a{'}\mbox{\hspace{0.50em}}yields\mbox{\hspace{0.50em}}{'}b{'}.}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{shuffle}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{w}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{w}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{instance}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Insert}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{shuffle}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{shuffle}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{instance}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Insert}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Insert}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v{'}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{$ \vartriangleright $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v{'}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{where}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{shuffle}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{shuffle}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{case}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{shuffle}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{f}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{of}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{New}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0.70,0.13,0.13}{\texttt{Old}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{y}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{substituteGen}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{:}{:}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{Insert}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b,}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Functor}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm,}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{Monad}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \Rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{v}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{b}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{$ \rightarrow $}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{tm}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{a}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{substituteGen}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{u}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{{\char `\=}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{substituteOut}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{x}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{t}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{fmap}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][l]{$ {(} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{shuffle}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{id}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{\mbox{\hspace{0.50em}}}}\textcolor[rgb]{0,0,0.80}{\texttt{u}}\textcolor[cmyk]{0,0.65,0.99,0}{\texttt{\makebox[1.22ex][r]{$ {)} $}}}\textcolor[rgb]{0,0,0.80}{\texttt{{\nopagebreak \newline%
}\vphantom{$\{$}}}%


%
%comment: -- -}
%


%
%comment: -- -}
%


%
%comment: -- -}
%


%
%comment: -- -}
%


%
%comment: -- -}
%


\end{document}
